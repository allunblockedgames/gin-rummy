require=function(){function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return a(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}return e}()({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../core/data"),o=$(window),s=location.hostname.replace(/\./,"_")+"_ad_",u=6e4,c=30*u,l={newGame:function(){return this.gamesPlayed>2},gamesWonThisSession:function(){return this.sessionGameWinCount>0}},d=function(){function e(t){r(this,e),this.config=t,o.on("game:won",this.onGameWon.bind(this)),o.on("game:start",this.onGameStart.bind(this)),o.on("winAnimation:end",this.onAnimationEnd.bind(this));this.requestAd.bind(this);(window.adConfig||function(e){return e})({preloadAdBreaks:"on"}),this.gamesPlayed=1,this.lastTimeAdWasDisplay=Date.now()-c+10*u,this.adsShownThisSession=1,this.sessionGameWinCount=0}return a(e,[{key:"onGameWon",value:function(){this.sessionGameWinCount++}},{key:"onGameStart",value:function(){this.gamesPlayed++,this.shouldDisplayAd()&&(this.beforeAdRequest(),this.requestAd())}},{key:"onAnimationEnd",value:function(){o.trigger("interstitial:hidden")}},{key:"beforeAdRequest",value:function(){}},{key:"shouldDisplayAd",value:function(){return!(!this.config.debug&&!this.checkTime())&&(this.checkConditions()?!!this.config.debug||Math.random()>.5:void 0)}},{key:"checkConditions",value:function(){return $.map(l,function(e,t){return e.call(this)}.bind(this)).filter(function(e){return e}).length}},{key:"requestAd",value:function(){var e=this;console.log("REQUEST AD"),this.soundState=i.data.get("sound"),adBreak({type:"next",name:s,beforeAd:function(){i.data.set("sound",!1),clearTimeout(void 0)},afterAd:function(){e.afterBreak()}})}},{key:"afterBreak",value:function(){this.lastTimeAdWasDisplay=Date.now(),this.gamesPlayed=0,this.sessionGameWinCount=0,this.adsShownThisSession++,i.data.set("sound",this.soundState)}},{key:"checkTime",value:function(){return Date.now()-this.lastTimeAdWasDisplay>c}}]),e}();i.data.on("game.loaded",function(){new d({})})},{"../core/data":"data"}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Board=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./core/observable");n.Board=function(){function e(t){r(this,e),this.onMouseOverCard=new i.Observable,this.onClickCard=new i.Observable,this.onMouseDownCard=new i.Observable,this.onMouseOutCard=new i.Observable,this.onMouseUpCard=new i.Observable,this.initEvents(t)}return a(e,[{key:"initEvents",value:function(e){function t(e){return{x:e.pageX-c.left,y:e.pageY-c.top}}function n(e,t){for(var n=e.pageX-c.left,r=e.pageY-c.top,a=t.length-1;a>=0;a--)if(t[a].view.hitTest(n,r))return t[a]}function r(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r}var a=this,i=void 0,o=void 0,s=null,u=$(document),c=$("#game-content").offset();$(window).on("board:resize",function(){c=$("#game-content").offset()}),u.on("click","#game-content",function(t){if(!o&&"BUTTON"!==t.target.tagName){var r=n(t,e);r&&a.onClickCard.notifyObservers(r,t)}});var l=void 0;u.on("mousedown",function(r){if("BUTTON"!==r.target.tagName){i=!0,l=t(r);var o=n(r,e);o&&a.onMouseDownCard.notifyObservers(o,r)}}),u.on("mouseup",function(e){setTimeout(function(e){i=!1,o=!1},200),s&&a.onMouseUpCard.notifyObservers(s,e)}),u.on("mousemove",function(u){if(i){if(!o&&r(l,t(u))<100)return;return void(o=!0)}var c=null;"BUTTON"!==u.target.tagName&&(c=n(u,e)),s&&c!==s&&a.onMouseOutCard.notifyObservers(s,u),c&&c!==s&&a.onMouseOverCard.notifyObservers(c,u),s=c})}}]),e}()},{"./core/observable":24}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.config=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=e("./core/config"),i=function(e){return e&&e.__esModule?e:{default:e}}(a);n.config=r({},i.default,{layoffAnimationTime:1e3})},{"./core/config":10}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.waste=n.stock=void 0;var r=e("./core/container");n.stock=new r.Stock,n.waste=new r.Waste},{"./core/container":11}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createAnimationFunctions=n.moveCard=void 0;var r=e("./layout"),a=e("./container"),i=e("./data"),o={"ease-in":function(e){return Math.pow(e,1.675)},"ease-out":function(e){return 1-Math.pow(1-e,1.675)},"ease-in-out":function(e){return e<.5?2*o["ease-in"](e):2*o["ease-out"](e)-1}},s=($(document),i.data.get("handMoveDelay")),u=void 0,c=void 0,l=void 0,d=function(e){return e},f=function(e,t){for(var n in e)if(e[n]!==t[n]&&"z"!==n)return!0;return!1},p=(n.moveCard=function(e,t){var n=t.x,r=t.y;e.x=n||e.x,e.y=r||e.y,p()},function(){c||(c=$("canvas")[0],l=c.getContext("2d")),c.width|=0,l.scale(r.layout.pixelRatio,r.layout.pixelRatio),l.translate(r.layout.centerX,r.layout.centerY),l.scale(r.layout.scale,r.layout.scale),u.forEach(function(e,t){e.view.draw(l)})}),h=function(e,t,n){return(1-n)*e+n*t},g=function(){u.sort(function(e,t){return(e.owner instanceof a.Waste?e.view.oldZ+1:e.z)-(t.owner instanceof a.Waste?t.view.oldZ+1:t.z)})},m=void 0,v=void 0;n.createAnimationFunctions=function(e){u=e,i.data.on("appearance.change",function(){u.forEach(function(e){return e.view.update()}),p()});var t={drawAll:p,stopAnimation:function(){d()},animate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.delay,n=void 0===t?0:t,r=e.duration,a=void 0===r?0:r,i=e.ease;return i=o[i]||o["ease-in"],new Promise(function(e,t){function r(){if(!o.length)return e();var t=Date.now()-y;o=o.filter(function(e){var r=e.view,o=n*e.ind*1e3,u=w?(e.delay||0)*s:0,c=w?500:a;if(e.delay&&r.newPosition.rotation){var l=t/s;l=i(l<1?l:1),r.position.rotation=h(r.oldPosition.rotation||0,r.newPosition.rotation||0,l)}if(t<u+o)return!0;var d=(t-(u+o))/(c||700);return d=i(d<1?d:1),r.position.x=h(r.oldPosition.x,r.newPosition.x,d),r.position.y=h(r.oldPosition.y,r.newPosition.y,d),r.position.rotation=h(r.oldPosition.rotation||0,r.newPosition.rotation||0,d),1!==d||(e.delay=0,e.view.oldZ=e.z,g(),!1)}),p(),m=requestAnimationFrame(r)}d=t;var o=u.filter(function(e,t){var n=e.owner.getPosForChild(e.ind);if(f(n,e.view.position))return e.view.oldZ=e.z||0,e.view.oldPosition=e.view.position,e.view.newPosition=n,e.view.position.z=n.z,!0;n.z!==e.view.position.z&&(e.view.position.z=n.z)});if(!o.length)return e();g(),v&&v(),v=e,cancelAnimationFrame(m),c=$("canvas")[0],l=c.getContext("2d");var y=Date.now(),w=0!==o.filter(function(e){return e.delay}).length;r()})},move:function(){return t.animate()}};return t}},{"./container":11,"./data":"data","./layout":19}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createAnimationFunctions=n.moveCard=void 0;var r=e("./layout"),a=e("./container"),i=e("./data"),o=$(document),s=i.data.get("handMoveDelay")/1e3,u=function(e){return e},c=function(e,t){for(var n in e)if(e[n]!==t[n]&&"z"!==n)return!0;return!1},l=(n.moveCard=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.x,a=t.y,i=t.z,o=t.rotation,s=t.duration;e.view.$dom.css({transform:"translate3d("+($.isNumeric(n)?n:e.x)+"px, "+(a||e.y)+"px, 0)\n                    rotateY("+(o||e.rotation)+"deg)\n                    scale("+r.layout.scale+") rotateY(360deg)","z-index":i||e.z,"transition-duration":(s||0)+"s"})},function(e){e.view.$dom.removeClass("aiplayer humanplayer hover"),e.owner&&e.owner.owner&&e.view.$dom.addClass(e.owner.owner._name)});n.createAnimationFunctions=function(e){return{drawAll:function(e){return 1},stopAnimation:function(){u()},animate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.delay,i=void 0===n?0:n,d=t.duration,f=void 0===d?0:d,p=t.ease;return new Promise(function(t,n){u=n;var d=e.filter(function(e,t){if(!e.owner)return!1;var n=e.owner.getPosForChild(e.ind);if(c(n,e.view.position))return e.view.oldPos=e.view.position,e.view.position=n,!0;n.z!==e.view.position.z&&e.view.$dom.css("z-index",n.z)});if(!d.length)return t();e.sort(function(e,t){return e.z-t.z});var h=d.length,g=[],m=function(e){var t=d.find(function(t){return t.view.$dom[0]===e.target});t&&v(t)&&w(t)},v=function(e){return-1!==g.indexOf(e)},y=function(e){g.push(e)},w=function(e){e.view.$dom.css("z-index",e.z),l(e),--h<=0&&(t(),o.off("transitionend",m))};o.on("transitionend",m),setTimeout(function(e){d.forEach(function(e,t){var n=parseInt(e.view.$dom.css("z-index"),10),o=e.owner instanceof a.Waste?n+1:e.z,u=function(){y(e),e.delay=0,e.view.$dom.css({transition:"","z-index":o,"transition-duration":f?f+"ms":"","transition-delay":i*e.ind+"s","transition-timing-function":p||"",transform:"translate3d("+e.x+"px, "+e.y+"px, 0)\n                            rotateY("+(e.rotation||0)+"deg)\n                            scale("+r.layout.scale+") rotateY(360deg)"})};e.delay&&e.rotation!==e.view.oldPos.rotation?(h++,y(e),e.view.$dom.css({"transition-duration":s+"s",transform:"translate3d("+e.view.oldPos.x+"px, "+e.view.oldPos.y+"px, 0)\n                                rotateY("+(e.rotation||0)+"deg)\n                                scale("+r.layout.scale+") rotateY(360deg)"}).one("transitionend",function(){u()})):setTimeout(u)})})})},move:function(){return new Promise(function(t,n){setTimeout(function(n){e.forEach(function(e,t){l(e),e.view.position=e.owner.getPosForChild(e.ind),e.view.$dom.css({"transition-duration":"","transform-delay":"0s","z-index":e.z,transform:"translate3d("+e.x+"px, "+e.y+"px, 0)\n                        rotateY("+(e.rotation||0)+"deg)\n                        scale("+r.layout.scale+") rotateY(360deg)"})}),setTimeout(t,1e3)},300)})}}}},{"./container":11,"./data":"data","./layout":19}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.CanvasView=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./card.view"),u=e("./config"),c=(function(e){e&&e.__esModule}(u),e("./data"),e("./resources")),l=e("./layout"),d=e("./utils"),f=document.createElement("canvas"),p=document.createElement("canvas"),h=p.getContext("2d"),g=void 0,m=function(){return window.devicePixelRatio},v=["#2196F3","#E91E63","#4CAF50"];n.CanvasView=function(e){function t(e){r(this,t),g||($("#game-content").append(f),f.width=$("#game-content").width()*m(),f.height=$("#game-content").height()*m(),f.style.width=$("#game-content").width()+"px",f.style.height=$("#game-content").height()+"px",$(window).on("board:resize",function(){f.width=$("#game-content").width()*m(),f.height=$("#game-content").height()*m(),f.style.width=$("#game-content").width()+"px",f.style.height=$("#game-content").height()+"px"}));var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.front=document.createElement("canvas"),n.frontCtx=n.front.getContext("2d"),n.$dom=$(),n._front=(0,c.getCardImage)(n.model.suit,n.model.rank),n.back=(0,c.getCardBackImage)(),n._drawFront(),n}return i(t,e),o(t,[{key:"tint",value:function(){this.tinted=!0,this._drawFront(),this.frontCtx.globalCompositeOperation="source-atop",this.frontCtx.fillStyle="rgba(0, 0, 0, .6)",this.frontCtx.fillRect(0,0,this._front.width,this._front.height)}},{key:"untint",value:function(){this.tinted=!1,this._drawFront()}},{key:"removeFromMeld",value:function(){this.inMeld=!1,this._drawFront()}},{key:"addToMeld",value:function(e){this.inMeld=!0,this.meldIndex=e,this._drawFront()}},{key:"update",value:function(){this.tinted?this.tint():this._drawFront()}},{key:"_drawFront",value:function(){this.front.width=this._front.width,this.front.height=this._front.height,this.frontCtx.drawImage(this._front,0,0),this.inMeld&&(this.frontCtx.globalCompositeOperation="source-atop",this.frontCtx.fillStyle=v[this.meldIndex],this.frontCtx.globalAlpha=.8,this.frontCtx.fillRect(0,0,this._front.width,.05*this._front.height|0))}},{key:"setPosition",value:function(e,t,n){this.position={x:e,y:t,z:n||this.z}}},{key:"setHighlight",value:function(e){this.highlight=!!e,e&&this.drawBlur(e)}},{key:"drawBlur",value:function(e){var t=this._front.width-2,n=this._front.height-2;p.width=this._front.width+44,p.height=this._front.height+44,h.shadowColor=e,h.shadowBlur=22;for(var r=0;r<5;r++)h.beginPath(),(0,d.polygon)(h,23,23,22+t,23,22+t,22+n,23,22+n,10),h.fill()}},{key:"draw",value:function(e){var t=Math.round(this.model.rotation),n=this.front.width,r=this.front.height;this.highlight&&180===t&&e.drawImage(p,this.position.x/l.layout.scale-22,this.position.y/l.layout.scale-22);var a=t<90?1-t/90:(t-90)/90,i=-n*a/2|0,o=this.position.y/l.layout.scale;e.save(),e.translate(this.position.x/l.layout.scale+this.front.width/2,0),e.drawImage(this.model.rotation>=90?this.front:this.back,0,0,n,r,i,180===t?Math.round(o):o,n*a,r),e.restore()}}]),t}(s.CardView)},{"./card.view":9,"./config":10,"./data":"data","./layout":19,"./resources":30,"./utils":36}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i={spade:"♠",heart:"♥",club:"♣",diamond:"♦"},o={1:"A",11:"J",12:"Q",13:"K"},s=function(){function e(t,n){r(this,e),this.suit=n,this.rank=t}return a(e,[{key:"adjustPos",value:function(){var e;(e=this.view).adjustPos.apply(e,arguments)}},{key:"setPosition",value:function(){var e;(e=this.view).setPosition.apply(e,arguments)}},{key:"removeFromMeld",value:function(){this.view.removeFromMeld()}},{key:"addToMeld",value:function(e){this.view.addToMeld(e)}},{key:"toString",value:function(){return""+(o[this.rank]||this.rank)+i[this.suit]}},{key:"toJSON",value:function(){return this.toString()}},{key:"x",get:function(){return this.view.position.x},set:function(e){this.view.position.x=e}},{key:"y",get:function(){return this.view.position.y},set:function(e){this.view.position.y=e}},{key:"z",get:function(){return this.view.position.z},set:function(e){this.view.position.z=e}},{key:"rotation",get:function(){return this.view.position.rotation||0},set:function(e){this.view.position.rotation=e}}]),e}();n.default=s;n.createCard=function(e){var t=e.rank,n=e.suit,r=e.View,a=new s(t,n);return a.view=new r(a),a}},{}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.CardView=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./layout");n.CardView=function(){function e(t){r(this,e),this.model=t,this.position={x:0,y:0},this.flipped=!0}return a(e,[{key:"owner",get:function(){return this.model.owner}},{key:"ind",get:function(){return this.model.ind}}]),a(e,[{key:"tint",value:function(){throw new Error("Not implemented")}},{key:"untint",value:function(){throw new Error("Not implemented")}},{key:"setPosition",value:function(e,t,n){throw new Error("Not implemented")}},{key:"setHighlight",value:function(e){throw new Error("Not implemented")}},{key:"removeFromMeld",value:function(){}},{key:"addToMeld",value:function(e){}},{key:"hitTest",value:function(e,t){return e-=i.layout.centerX,t-=i.layout.centerY,e>this.position.x&&e<this.position.x+i.layout.cardWidth&&t>this.position.y&&t<this.position.y+i.layout.cardHeight}}]),e}()},{"./layout":19}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={version:1,isFreeApp:!0,offsetStockDiv:2};n.default=r},{}],11:[function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Layoff=n.Hand=n.Waste=n.Stock=n.Container=void 0;var o=function e(t,n,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(r)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./config"),c=function(e){return e&&e.__esModule?e:{default:e}}(u),l=e("./layout"),d=e("./utils"),f=n.Container=function(){function e(){i(this,e),this.position={x:0,y:0},this.cards=[],this.push.apply(this,arguments)}return s(e,[{key:"reset",value:function(){this.cards.length=0}},{key:"contains",value:function(e){return-1!==this.cards.indexOf(e)}},{key:"push",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach(function(t){t.owner=e,e.cards.push(t)}),this.updateIndexes()}},{key:"splice",value:function(){var e;(e=this.cards).splice.apply(e,arguments),this.updateIndexes()}},{key:"unshift",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach(function(t){t.owner=e,e.cards.unshift(t)}),this.updateIndexes()}},{key:"updateIndexes",value:function(){this.cards.forEach(function(e,t){e.ind=t})}},{key:"last",value:function(){return this.cards[this.cards.length-1]}},{key:"pop",value:function(){var e=this.cards.pop();return e.owner=h,this.updateIndexes(),e}},{key:"map",value:function(e){return this.cards.map(e)}},{key:"setPosition",value:function(e,t){this.position={x:e,y:t}}},{key:"indexOf",value:function(e){return this.cards.indexOf(e)}},{key:"remove",value:function(e){if(this.contains(e)){var t=this.cards.indexOf(e);this.cards.splice(t,1),this.updateIndexes()}}},{key:"getPosForChild",value:function(e){return{x:this.position.x,y:this.position.y,z:e,rotation:0}}},{key:"adjustPos",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.cards.forEach(function(e){e.adjustPos.apply(e,t)})}},{key:"sort",value:function(){(0,d.sortCards)(this.cards),this.updateIndexes()}},{key:"isCardInMiddle",value:function(e){return!!this.contains(e)&&(0!==e.ind&&e.ind!==this.size-1)}},{key:"toJSON",value:function(){return this.cards}},{key:"size",get:function(){return this.cards.length}}]),e}(),p=(n.Stock=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"getPosForChild",value:function(e){return{x:this.position.x-Math.floor(e/c.default.offsetStockDiv),y:this.position.y-Math.floor(e/c.default.offsetStockDiv),z:e,rotation:0}}}]),t}(f),n.Waste=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"getPosForChild",value:function(e){var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getPosForChild",this).call(this,e);return n.rotation=e<this.size&&this.cards[e].isKnockCard?0:180,n.z=e,n}},{key:"addKnockCard",value:function(e){this.push(e),e.isKnockCard=!0}}]),t}(f),n.Hand=function(e){function t(){var e;i(this,t);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a)));return s._separation=.55,s}return a(t,e),s(t,[{key:"unshift",value:function(){for(var e,n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return this.rotation&&r.forEach(function(e,t){e.delay=t+1}),(e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"unshift",this)).call.apply(e,[this].concat(r))}},{key:"updateIndexes",value:function(){this.knock||o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateIndexes",this).call(this)}},{key:"getPosForChild",value:function(e){return{x:this.position.x+(this.width-l.layout.cardWidth)/2-e*this.separation,y:this.position.y,rotation:this.rotation||0,z:200-e}}},{key:"width",get:function(){return this.size?this.separation*(this.size-1)+l.layout.cardWidth:0}},{key:"separation",get:function(){return Math.floor(l.layout.cardWidth*this._separation)}}]),t}(f)),h=(n.Layoff=function(e){function t(){var e;i(this,t);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a)));return s._separation=.3,s}return a(t,e),s(t,[{key:"getPosForChild",value:function(e){return{x:this.position.x+this.width-l.layout.cardWidth-this.separation*e,y:this.position.y,rotation:180,z:200-e}}}]),t}(p),new f)},{"./config":10,"./layout":19,"./utils":36}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.computed=void 0;var r=e("../platform"),a={winApp:function(e){e.set("moreGamesLink","ms-windows-store://publisher/?name=TreeCardGames"),e.on("language",function(t){e.set("privacyLink","/privacy/privacy.htm")}),e.set("rateLink",new Windows.Foundation.Uri("ms-windows-store://review/?ProductId=9N19CBQTPC6W"))},exe:function(e){e.set("privacyLink","/privacy/privacy.htm"),e.set("buyLink","https://www.treecardgames.com/gr/buy.htm"),e.set("isExeActivated",window.isExeActivated)},web:function(e){e.on("language",function(t){e.set("privacyLink","/privacy/privacy.htm")}),e.set("rateLink","https://chrome.google.com/webstore/detail/gin-rummy/ckoiipokifpjhhkeegikiljbnpcnhiip")},cordova:function(e){this.web(e),e.set("rateLink","http://www.treecardgames.com")},defaults:function(e){e.set("moreGamesLink","https://www.treecardgames.com/games_browser.htm")}};n.computed=function(e){a.defaults(e);try{a[r.platform.name](e)}catch(e){console.log("No computed settings for "+r.platform.name)}}},{"../platform":26}],13:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Data=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../uniStore"),c=e("events");n.Data=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.uniStore;r(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.defaults=o({},e),i.data={},i.wrappers={},i.storage=n,i}return i(t,e),s(t,[{key:"initialize",value:function(){for(var e in this.defaults)this.emit(e,this._get(e))}},{key:"get",value:function(e){return this.data[e]||this._get(e)}},{key:"set",value:function(e,t){var n=this.get(e);this.data[e]=t,this.storage.setJSON(e,t),this.emit(e,this.get(e),n),this.emit("*",e,t,n)}},{key:"forceUpdate",value:function(e){this.emit(e,this.get(e)),this.emit("*",e,this.get(e))}},{key:"_get",value:function(e,t){return this.data[e]=this.storage.getJSON(e),(void 0===this.data[e]||null===this.data[e])&&void 0!==this.defaults[e]&&(this.data[e]=this._clone(this.defaults[e],e)),this.wrappers[e]&&(this.data[e]=this.wrappers[e](this.data[e])),this.data[e]}},{key:"addWrapper",value:function(e,t){this.wrappers[e]=t}},{key:"_clone",value:function(e,t){try{return JSON.parse(JSON.stringify(e))}catch(e){console.log("Error cloning config "+t)}}},{key:"off",value:function(){return this.removeListener.apply(this,arguments)}}]),t}(c.EventEmitter)},{"../uniStore":35,events:69}],14:[function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.defaults=n.isNewInstall=void 0;var a,i=e("./images"),o=e("../platform"),s=e("../uniStore");s.uniStore.get("isNewInstall")||s.uniStore.set("isNewInstall",!s.uniStore.get("game.loaded"));var u=n.isNewInstall="true"===s.uniStore.get("isNewInstall");n.defaults=(a={version:window.VERSION||"3.5",imageMakerUrl:"game/js/lib/image-maker/player-image-maker.html",isNewInstall:u,language:o.platform.language,platform:o.platform.name},r(a,o.platform.name,!0),r(a,"background","green_felt"),r(a,"cardset","modern"),r(a,"cardback","rhombus_blue"),r(a,"sound",!0),r(a,"confirmMove",!1),r(a,"visualEffects",!0),r(a,"autoSort",!0),r(a,"handMoveDelay",300),r(a,"winScore",100),r(a,"languages",i.languages),r(a,"backgrounds",i.backgrounds),r(a,"cardbacks",i.cardbacks),r(a,"cardsets",i.cardsets),r(a,"themes",i.themes),r(a,"avatars",u?i.newAvatars:i.oldAvatars.concat(i.newAvatars)),r(a,"score",{human:[],cpu:[]}),r(a,"maxPlayerNameLen",20),r(a,"statistics",{won:0,lost:0,currentStreak:0,longestLosingStreak:0,longestWinningStreak:0,currentStreakType:""}),r(a,"players",{human:{_name:"player_name1",avatar:u?"pn500":"p40",description:"player1"},cpu:{_name:"player_name2",avatar:u?"pn103":"p4",description:"player2"}}),a)},{"../platform":26,"../uniStore":35,"./images":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./languages");Object.defineProperty(n,"languages",{enumerable:!0,get:function(){return r.languages}});var a="game/assets/images/";n.cardbacks=[[{title:"Rhombus Blue",image:a+"backs/thumbnails/rhombus_blue.png",name:"rhombus_blue"},{title:"Rhombus Brown",image:a+"backs/thumbnails/rhombus_brown.png",name:"rhombus_brown"},{title:"Rhombus Green",image:a+"backs/thumbnails/rhombus_green.png",name:"rhombus_green"},{title:"Rhombus Red",image:a+"backs/thumbnails/rhombus_red.png",name:"rhombus_red"}],[{title:"Grate Blue",image:a+"backs/thumbnails/cross_blue.png",name:"cross_blue"},{title:"Grate Brown",image:a+"backs/thumbnails/cross_brown.png",name:"cross_brown"},{title:"Grate Green",image:a+"backs/thumbnails/cross_green.png",name:"cross_green"},{title:"Grate Red",image:a+"backs/thumbnails/cross_red.png",name:"cross_red"}],[{title:"Butterflies",image:a+"backs/thumbnails/butterflies.png",name:"butterflies"},{title:"Dog",image:a+"backs/thumbnails/dog.png",name:"dog"},{title:"Puppy Love",image:a+"backs/thumbnails/puppy_love.png",name:"puppy_love"},{title:"Cat",image:a+"backs/thumbnails/cat.png",name:"cat"}],[{title:"White Kitten",image:a+"backs/thumbnails/white_kitten.png",name:"white_kitten"},{title:"Pink Daisy",image:a+"backs/thumbnails/pink_daisy.png",name:"pink_daisy"},{title:"Rose",image:a+"backs/thumbnails/rose.png",name:"rose"},{title:"Story Time",image:a+"backs/thumbnails/story_time.png",name:"story_time"}],[{title:"Lawrence",image:a+"backs/thumbnails/lawrence.png",name:"lawrence"},{title:"Monet",image:a+"backs/thumbnails/monet.png",name:"monet"},{title:"Renoir",image:a+"backs/thumbnails/renoir.png",name:"renoir"},{title:"Classic Blue",image:a+"backs/thumbnails/classic_blue.png",name:"classic_blue"}],[{title:"Classic Brown",image:a+"backs/thumbnails/classic_brown.png",name:"classic_brown"},{title:"Classic Green",image:a+"backs/thumbnails/classic_green.png",name:"classic_green"},{title:"Classic Red",image:a+"backs/thumbnails/classic_red.png",name:"classic_red"}]],n.backgrounds=[[{title:"Green Felt",image:a+"backgrounds/thumbnails/green_felt.jpg",name:"green_felt"},{title:"Light Wood Tiles",image:a+"backgrounds/thumbnails/light_wood_tiles.jpg",name:"light_wood_tiles"},{title:"Red Felt",image:a+"backgrounds/thumbnails/red_felt.jpg",name:"red_felt"}],[{title:"Dark Wood",image:a+"backgrounds/thumbnails/dark_wood.jpg",name:"dark_wood"},{title:"Blue Rays",image:a+"backgrounds/thumbnails/blue_rays.jpg",name:"blue_rays"},{title:"Light Wood",image:a+"backgrounds/thumbnails/light_wood.jpg",name:"light_wood"}],[{title:"Parquet",image:a+"backgrounds/thumbnails/parquet.jpg",name:"parquet"},{title:"Blue Felt",image:a+"backgrounds/thumbnails/blue_felt.jpg",name:"blue_felt"},{title:"Puppies",image:a+"backgrounds/thumbnails/puppies.jpg",name:"puppies"}],[{title:"Curious Kittens",image:a+"backgrounds/thumbnails/curious_kittens.jpg",name:"curious_kittens"},{title:"Field of Daisies",image:a+"backgrounds/thumbnails/field_of_daisies.jpg",name:"field_of_daisies"}]],n.cardsets=[[{title:"Big Ben",image:a+"cards/thumbnails/big_ben.png",name:"big_ben"},{title:"Caricatures",image:a+"cards/thumbnails/caricatures.png",name:"caricatures"},{title:"Large Print",image:a+"cards/thumbnails/large_print.png",name:"large_print"}],[{title:"Large Print London",image:a+"cards/thumbnails/large_print_london.png",name:"large_print_london"},{title:"Large Print Modern",image:a+"cards/thumbnails/large_print_modern.png",name:"large_print_modern"},{title:"Modern",image:a+"cards/thumbnails/modern.png",name:"modern"}],[{title:"Flowers",image:a+"cards/thumbnails/flowers_close_ups.png",name:"flowers_close_ups"},{title:"Kittens",image:a+"cards/thumbnails/kittens.png",name:"kittens"},{title:"Puppies",image:a+"cards/thumbnails/puppies.png",name:"puppies"}]],n.themes=[[{name:"green_felt",image:a+"themes/green_felt.jpg",images:["modern","rhombus_blue","green_felt"]},{name:"light_wood",image:a+"themes/light_wood.jpg",
images:["modern","rhombus_red","light_wood_tiles"]},{name:"red_felt",image:a+"themes/red_felt.jpg",images:["big_ben","rhombus_blue","red_felt"]}],[{name:"large_print_green",image:a+"themes/large_print_green.jpg",images:["large_print_london","rhombus_blue","green_felt"]},{name:"large_print_wood",image:a+"themes/large_print_wood.jpg",images:["large_print","rhombus_red","dark_wood"]},{name:"caricatures",image:a+"themes/caricatures.jpg",images:["caricatures","story_time","blue_rays"]}],[{name:"puppies",image:a+"themes/puppies.jpg",images:["puppies","puppy_love","puppies"]},{name:"kittens",image:a+"themes/kittens.jpg",images:["kittens","white_kitten","curious_kittens"]},{name:"flowers",image:a+"themes/flowers.jpg",images:["flowers_close_ups","pink_daisy","field_of_daisies"]}]],n.oldAvatars=[[{name:"p1",image:"game/assets/images/players/p1.png"},{name:"p2",image:"game/assets/images/players/p2.png"},{name:"p3",image:"game/assets/images/players/p3.png"},{name:"p4",image:"game/assets/images/players/p4.png"},{name:"p5",image:"game/assets/images/players/p5.png"}],[{name:"p6",image:"game/assets/images/players/p6.png"},{name:"p7",image:"game/assets/images/players/p7.png"},{name:"p8",image:"game/assets/images/players/p8.png"},{name:"p9",image:"game/assets/images/players/p9.png"},{name:"p10",image:"game/assets/images/players/p10.png"}],[{name:"p11",image:"game/assets/images/players/p11.png"},{name:"p12",image:"game/assets/images/players/p12.png"},{name:"p13",image:"game/assets/images/players/p13.png"},{name:"p14",image:"game/assets/images/players/p14.png"},{name:"p15",image:"game/assets/images/players/p15.png"}],[{name:"p16",image:"game/assets/images/players/p16.png"},{name:"p17",image:"game/assets/images/players/p17.png"},{name:"p18",image:"game/assets/images/players/p18.png"},{name:"p19",image:"game/assets/images/players/p19.png"},{name:"p20",image:"game/assets/images/players/p20.png"}],[{name:"p21",image:"game/assets/images/players/p21.png"},{name:"p22",image:"game/assets/images/players/p22.png"},{name:"p23",image:"game/assets/images/players/p23.png"},{name:"p24",image:"game/assets/images/players/p24.png"},{name:"p25",image:"game/assets/images/players/p25.png"}],[{name:"p26",image:"game/assets/images/players/p26.png"},{name:"p27",image:"game/assets/images/players/p27.png"},{name:"p28",image:"game/assets/images/players/p28.png"},{name:"p29",image:"game/assets/images/players/p29.png"},{name:"p30",image:"game/assets/images/players/p30.png"}],[{name:"p31",image:"game/assets/images/players/p31.png"},{name:"p32",image:"game/assets/images/players/p32.png"},{name:"p33",image:"game/assets/images/players/p33.png"},{name:"p34",image:"game/assets/images/players/p34.png"},{name:"p35",image:"game/assets/images/players/p35.png"}],[{name:"p36",image:"game/assets/images/players/p36.png"},{name:"p37",image:"game/assets/images/players/p37.png"},{name:"p38",image:"game/assets/images/players/p38.png"},{name:"p39",image:"game/assets/images/players/p39.png"},{name:"p40",image:"game/assets/images/players/p40.png"}]],n.newAvatars=[[{name:"pn100",image:"game/assets/images/players/pn100.png"},{name:"pn101",image:"game/assets/images/players/pn101.png"},{name:"pn102",image:"game/assets/images/players/pn102.png"},{name:"pn103",image:"game/assets/images/players/pn103.png"},{name:"pn104",image:"game/assets/images/players/pn104.png"}],[{name:"pn105",image:"game/assets/images/players/pn105.png"},{name:"pn106",image:"game/assets/images/players/pn106.png"},{name:"pn107",image:"game/assets/images/players/pn107.png"},{name:"pn108",image:"game/assets/images/players/pn108.png"},{name:"pn109",image:"game/assets/images/players/pn109.png"}],[{name:"pn110",image:"game/assets/images/players/pn110.png"},{name:"pn111",image:"game/assets/images/players/pn111.png"},{name:"pn112",image:"game/assets/images/players/pn112.png"},{name:"pn113",image:"game/assets/images/players/pn113.png"},{name:"pn114",image:"game/assets/images/players/pn114.png"}],[{name:"pn115",image:"game/assets/images/players/pn115.png"},{name:"pn116",image:"game/assets/images/players/pn116.png"},{name:"pn117",image:"game/assets/images/players/pn117.png"},{name:"pn118",image:"game/assets/images/players/pn118.png"},{name:"pn119",image:"game/assets/images/players/pn119.png"}],[{name:"pn120",image:"game/assets/images/players/pn120.png"},{name:"pn121",image:"game/assets/images/players/pn121.png"},{name:"pn122",image:"game/assets/images/players/pn122.png"},{name:"pn123",image:"game/assets/images/players/pn123.png"},{name:"pn124",image:"game/assets/images/players/pn124.png"}],[{name:"pn300",image:"game/assets/images/players/pn300.png"},{name:"pn301",image:"game/assets/images/players/pn301.png"},{name:"pn302",image:"game/assets/images/players/pn302.png"},{name:"pn303",image:"game/assets/images/players/pn303.png"},{name:"pn304",image:"game/assets/images/players/pn304.png"}],[{name:"pn305",image:"game/assets/images/players/pn305.png"},{name:"pn306",image:"game/assets/images/players/pn306.png"},{name:"pn307",image:"game/assets/images/players/pn307.png"},{name:"pn308",image:"game/assets/images/players/pn308.png"},{name:"pn309",image:"game/assets/images/players/pn309.png"}],[{name:"pn310",image:"game/assets/images/players/pn310.png"},{name:"pn311",image:"game/assets/images/players/pn311.png"},{name:"pn312",image:"game/assets/images/players/pn312.png"},{name:"pn313",image:"game/assets/images/players/pn313.png"},{name:"pn314",image:"game/assets/images/players/pn314.png"}],[{name:"pn315",image:"game/assets/images/players/pn315.png"},{name:"pn316",image:"game/assets/images/players/pn316.png"},{name:"pn317",image:"game/assets/images/players/pn317.png"},{name:"pn318",image:"game/assets/images/players/pn318.png"},{name:"pn319",image:"game/assets/images/players/pn319.png"}],[{name:"pn320",image:"game/assets/images/players/pn320.png"},{name:"pn321",image:"game/assets/images/players/pn321.png"},{name:"pn322",image:"game/assets/images/players/pn322.png"},{name:"pn323",image:"game/assets/images/players/pn323.png"},{name:"pn324",image:"game/assets/images/players/pn324.png"}],[{name:"pn500",image:"game/assets/images/players/pn500.png"},{},{},{},{}]]},{"./languages":16}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.languages=[{value:"da",title:"Dansk"},{value:"de",title:"Deutsch"},{value:"en",title:"English"},{value:"es",title:"Español"},{value:"fr",title:"Français"},{value:"hi",title:"हिंदी"},{value:"it",title:"Italiano"},{value:"ja",title:"日本語"},{value:"nb",title:"Norsk"},{value:"nl",title:"Nederlands"},{value:"pl",title:"Polski"},{value:"pt",title:"Português"},{value:"ru",title:"Русский"},{value:"sv",title:"Svenska"},{value:"zh_hans",title:"简体中文"},{value:"zh_hant",title:"繁體中文"}]},{}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.DomView=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./card.view"),u=e("./config"),c=(function(e){e&&e.__esModule}(u),e("./resources")),l=(e("./layout"),function(e){return!1});n.DomView=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.$dom=$("<div>"),n.$dom.addClass("poker-card"),n.$dom[0].onselectstart=l,n.front=(0,c.getCardImage)(n.model.suit,n.model.rank),n.front.ondragstart=l,n.front.className="front",n.$dom.append(n.front),n.back=(0,c.getCardBackImage)(),n.back.className="back",n.back.ondragstart=l,n.$dom.append(n.back),n.$dom.appendTo("#game-content"),n}return i(t,e),o(t,[{key:"tint",value:function(){this.$dom.addClass("tint")}},{key:"untint",value:function(){this.$dom.removeClass("tint")}},{key:"removeFromMeld",value:function(){this.$dom.removeClass("meld").removeAttr("data-meld")}},{key:"addToMeld",value:function(e){this.$dom.addClass("meld").attr("data-meld",e)}},{key:"setPosition",value:function(e,t,n){this.position={x:e,y:t,z:n||this.z},this.$dom.css({x:e,y:t})}},{key:"setHighlight",value:function(e){var t=e?"0 0 20px 5px "+e:"";this.$dom.css("box-shadow",t)}}]),t}(s.CardView)},{"./card.view":9,"./config":10,"./layout":19,"./resources":30}],18:[function(e,t,n){"use strict";var r=e("./data"),a=(e("./language"),e("./popups")),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a),o=null,s=!1;r.data.on("createAvatar",function(e){localStorage.setItem("imageMakerLanguage",r.data.get("language")),s=!1,o=e,i.open("image-maker")}),$(document).on("click","page-image-maker .close-button",function(e){s?u():l()});var u=function(e){i.confirmSave().then(function(e){c()}).catch(function(e){l()})},c=function(e){$(".image-maker-modal iframe")[0].contentWindow.postMessage({type:"request-save"},location.origin)},l=function(e){i.close("image-maker")};window.addEventListener("message",function(e){if(e.origin===location.origin){var t=e.data||{};if("avatar"===t.type){var n=r.data.get("players"),a=JSON.parse(JSON.stringify(n[o]));a.avatar=t.value,n[o]=a,r.data.set("players",n),l()}else"avatar-gender"===t.type&&(s=!0)}})},{"./data":"data","./language":"language","./popups":"popups"}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=146,o=198,s=$(window),u=function(){return window.devicePixelRatio},c=function(){function e(t){r(this,e),this.scale=1,this.width=t.width(),this.height=t.height(),this.container=t,this.originalCardWidth=i,this.originalCardHeight=o}return a(e,[{key:"calcSize",value:function(){var e=this,t=9*i,n=6*i;this.width=this.container.width(),this.height=this.container.height(),this.scale=+Math.min(this.width/t,this.height/n,1).toFixed(2),this.pixelRatio=u(),setTimeout(function(){s.trigger("board:resize",e)},500)}},{key:"cardWidth",get:function(){return Math.floor(i*this.scale)}},{key:"cardHeight",get:function(){return Math.floor(o*this.scale)}},{key:"handWidth",get:function(){return.5*this.cardWidth*11}},{key:"handRight",get:function(){return Math.floor(this.handWidth+(this.width-this.handWidth)/2)}},{key:"centerX",get:function(){return Math.ceil(this.width/2-this.cardWidth/2)}},{key:"centerY",get:function(){return Math.ceil(this.height/2-this.cardHeight/2)}},{key:"top",get:function(){return-this.centerY}},{key:"bottom",get:function(){return this.centerY}},{key:"left",get:function(){return-this.centerX}},{key:"right",get:function(){return this.centerX}}]),e}(),l=n.layout=new c($("ion-app")),d=function(){l.calcSize()},f=void 0;d(),s.on("resize",function(e){clearTimeout(f),f=setTimeout(d,400)})},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.preload=n.progressBar=void 0;var r=e("./progressbar");Object.defineProperty(n,"progressBar",{enumerable:!0,get:function(){return r.progressBar}});var a=e("./preloader");Object.defineProperty(n,"preload",{enumerable:!0,get:function(){return a.preload}});var i=e("./loader"),o=function(e){return e&&e.__esModule?e:{default:e}}(i);n.default=o.default},{"./loader":21,"./preloader":22,"./progressbar":23}],21:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i={},o=[],s=function(e){var t=e.id;return!i[t]},u=function(e){return"string"==typeof e?{src:e,id:e}:e},c={clear:function(){i={}},load:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=jQuery.Deferred(),a=0;t=t.map(u).filter(s),r.notify(0);for(var c,l=function(){a++,r.notify(a/t.length),a===t.length&&r.resolve()},d=0;c=t[d];d++)!function(e,t){var n=o.find(function(e){return e.test(t)});n&&(i[t.id]=n.load(t,l))}(0,c);return r.promise()},get:function(e){return i[e]},register:function(e){o.push(e)}};c.register({test:function(e){return/\.(png|jpg)$/.test(e.src)},load:function(e,t){var n=new Image;return n.onload=t,n.src=e.src,n}}),c.register({test:function(e){return/\.js$/.test(e.src)},load:function(e,t){var n=e.src;e.scripts;return $.getScript(n,t)}}),c.register({test:function(e){return"ionic"===e.type},load:function(e,t){var n,i=e.scripts;document.addEventListener("ionic-load",t);var o=function(e){return $.ajax({url:e,dataType:"text"})};return(n=$).when.apply(n,r(i.map(o))).done(function(){for(var e=Object.defineProperty,t=Object.defineProperties,n=Promise.prototype.finally,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];i.forEach(function(e){var t=a(e,1),n=t[0];$.globalEval(n)}),Object.defineProperty=e,Object.defineProperties=t,Promise.prototype.finally=n}),!0}}),n.default=c},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.preload=void 0;var r=e("./loader"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),i=$(".preloader");n.preload=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(function(e){return a.default.get(e)}).length===t.length?Promise.resolve():(i.show(),new Promise(function(e){a.default.load.apply(a.default,t).then(function(){setTimeout(function(){i.hide(),e()},200)})}))}},{"./loader":21}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.progressBar=void 0;var r=e("./loader"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),i=e("../platform");n.progressBar=function(){var e=$(".splash--progress"),t=$.Deferred(),n=i.platform.winApp&&window.ExtendedSplash?new ExtendedSplash("#22903B"):{hide:function(){}};return a.default.load.apply(a.default,arguments).progress(function(t){e.css("width",100*t+"%")}).then(function(){setTimeout(function(){setTimeout(function(e){return n.hide()},500),t.resolve(),window.dispatchEvent(createEvent("game.loaded"))},400)}),t.promise()}},{"../platform":26,"./loader":21}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.Observable=function(){function e(){r(this,e),this._observers=[]}return a(e,[{key:"registerObserver",value:function(e){this._observers.push(e)}},{key:"notifyObservers",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._observers.forEach(function(e){(e.notify||e).apply(void 0,t)})}}]),e}()},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=[{name:"opera",check:/OPR|Opera/},{name:"msedge",check:/Edge/},{name:"msedgeChromium",check:/Edg/},{name:"chrome",check:/Chrome/},{name:"safari",check:/Safari/},{name:"mozilla",check:/Firefox/},{name:"msie",check:/MSIE|Trident/}],a=navigator.userAgent;n.browser=function(){var e=!0,t=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;if(s.check.test(a))return s.name}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}()},{}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.platform=void 0;var r,a,i=e("./name"),o=e("./language"),s=e("./browser");n.platform=(r={get name(){return i.name},get language(){return o.language}},a={},a[i.name]=a[i.name]||{},a[i.name].get=function(){return!0},a[s.browser]=a[s.browser]||{},a[s.browser].get=function(){return!0},function(e,t){for(var n in t){var r=t[n];r.configurable=r.enumerable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n,r)}return e}(r,a),r)},{"./browser":25,"./language":27,"./name":28}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.language=void 0;var r=e("./name"),a=e("../data/languages"),i=function(){return[].slice.call(Windows.System.UserProfile.GlobalizationPreferences.languages).map(s).filter(o)[0]||"en"},o=function(e){return a.languages.filter(function(t){return t.value===e}).length},s=function(e){return e=e.toLowerCase().replace("-","_"),"zh_hant"===e.substring(0,7)||"zh_hk"===e||"zh_mo"===e||"zh_tw"===e?"zh_hant":"zh"===e.substring(0,2)?"zh_hans":e.substring(0,2)};n.language=function(){switch(r.name){case"exe":return s(navigator.language);case"winApp":return i();default:return"en"}}()},{"../data/languages":16,"./name":28}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={exe:function(){return window.process&&window.process.pid},winApp:function(){return"undefined"!=typeof Windows},cordova:function(){return!!window.cordova}};n.name=function(){for(var e in r)if(r[e]())return e;return"web"}()},{}],29:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Player=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./observable");n.Player=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.hand=e,n.hand&&(n.hand.owner=n),n}return i(t,e),o(t,[{key:"reset",value:function(){this.hand.reset(),this.hand.knock=!1}},{key:"notify",value:function(){throw new Error("Please implement the notify method")}},{key:"toJSON",value:function(){return{hand:this.hand}}}]),t}(s.Observable)},{"./observable":24}],30:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getResources=n.getCardBackImage=n.getCardImage=void 0;var a=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("./data"),o=e("./loader"),s=function(e){return e&&e.__esModule?e:{default:e}}(o),u=(e("./platform"),e("./layout")),c=e("./utils"),l=[],d=[],f=["spade","heart","club","diamond"],p=(0,c.flatten)(i.data.get("themes")),h=function(){var e=document.getElementById("game-content"),t=e.cloneNode(!0),n=$(".humanplayer canvas",e).get(),r=$(".humanplayer canvas",t).get();if(n.length)r.forEach(function(e,t){e.getContext("2d").drawImage(n[t],0,0)});else{var a=$("canvas",e)[0];$("canvas",t)[0].getContext("2d").drawImage(a,0,0)}return t.id="",e.parentElement.appendChild(t),t},g=function(e,t){o.preload.apply(void 0,r(e)).then(function(){var e=h();t(),i.data.set("appearance.change",!0),setTimeout(function(t){$(e).fadeOut(500,function(){$(e).remove()})},300)})};i.data.on("game.loaded",function(){S(),setTimeout(m,1e3)});var m=function(){i.data.on("cardset",y),i.data.on("cardback",w),i.data.on("background",b)},v=function(){i.data.off("cardset",y),i.data.off("cardback",w),i.data.off("background",b)},y=function(){g([O()],j)},w=function(){g([P()],C)},b=function(e){g([k()],S)};i.data.on("theme",function(e){var t=p.find(function(t){return t.name===e}),n=a(t.images,3),r=n[0],o=n[1],s=n[2];g([O(r),P(o),k(s)],function(){v(),i.data.set("cardset",r),i.data.set("background",s),i.data.set("cardback",o),j(),C(),S(),m()})});var _=(n.getCardImage=function(e,t){var n=_(e,t);return l.push({raw:[e,t],img:n}),n},function(e,t,n){var r=s.default.get(O()),a=n||document.createElement("canvas"),i=a.getContext("2d"),o=f.indexOf(e),l=14===t?0:t-1,d=l*u.layout.originalCardWidth,p=o*u.layout.originalCardHeight;a.width=u.layout.originalCardWidth,a.height=u.layout.originalCardHeight,i.drawImage(r,d,p,a.width,a.height,0,0,a.width,a.height),i.globalCompositeOperation="destination-in";var h=a.width,g=a.height;return(0,c.polygon)(i,0,0,h,0,h,g,0,g,10),i.fill(),a.style.backgroundImage="url("+a.toDataURL()+")",a}),k=(n.getCardBackImage=function(){var e=s.default.get(P()).cloneNode();return d.push(e),e},function(e){return"game/assets/images/backgrounds/1920x1200/"+(e||i.data.get("background"))+".jpg"}),O=function(e){return"game/assets/images/cards/146x198/"+(e||i.data.get("cardset"))+".png"},P=function(e){return"game/assets/images/backs/146x198/"+(e||i.data.get("cardback"))+".png"},S=function(){$("body").css("background-image","url("+k()+")"),$("#game-content").css("background-image","url("+k()+")")},j=function(){l.forEach(function(e){_.apply(void 0,r(e.raw).concat([e.img]))})},C=function(){d.forEach(function(e){e.src=P()})};n.getResources=function(){var e=[{type:"ionic",scripts:["game/build/polyfills.js","game/build/vendor.js","game/build/main.js"]},"game/js/lang/en.js","game/js/lang/"+i.data.get("language")+".js",O(),P(),k(),{id:"deal",src:"game/assets/sounds/deal_animation.mp3"},{id:"selectCard",src:"game/assets/sounds/card_select.mp3"},{id:"moveCard",src:"game/assets/sounds/move_card.mp3"},{id:"passCards",src:"game/assets/sounds/passing_cards.mp3"},{id:"collectCards",src:"game/assets/sounds/collect_cards.mp3"},{id:"gameCompleted",src:"game/assets/sounds/game_completed.mp3"},{id:"gameWon",src:"game/assets/sounds/game_won.mp3"}],t=i.data.get("players");return["human","cpu"].forEach(function(n){-1===t[n].avatar.indexOf("data:")&&e.push("game/assets/images/players/"+t[n].avatar+".png")}),e}},{"./data":"data","./layout":19,"./loader":20,"./platform":26,"./utils":36}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.sound=void 0;var r=e("./soundjs"),a=e("../loader"),i=function(e){return e&&e.__esModule?e:{default:e}}(a);n.sound=new r.Sound;i.default.register({test:function(e){return/\.(mp3|ogg|wav)$/.test(e.src)},load:r.soundLoader})},{"../loader":20,"./soundjs":33}],32:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.Sound=function(){function e(){r(this,e),this.isMuted=!1}return a(e,[{key:"load",value:function(e){throw new Error("Method not implemented")}},{key:"mute",value:function(){this.isMuted=!0}},{key:"unmute",value:function(){this.isMuted=!1}},{key:"play",value:function(e){this.isMuted||this._play(e)}},{key:"_play",value:function(e){throw new Error("Method not implemented")}}]),e}()},{}],33:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.soundLoader=n.Sound=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./sound"),u={},c=function(e){u[e]=u[e]||[];var t=u[e].find(function(e){return"playFinished"===e.playState});t?t.play():u[e].push(createjs.Sound.play(e))};n.Sound=function(e){function t(){return r(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),o(t,[{key:"_play",value:function(e){c(e)}}]),t}(s.Sound);createjs.Sound.alternateExtensions=["ogg","m4a"];var l={},d=function(e){var t=e.id;l[t]&&(l[t](),delete l[t])};createjs.Sound.on("fileload",d),createjs.Sound.on("fileerror",d);n.soundLoader=function(e,t){var n=e.src,r=e.id;l[r]=t,createjs.Sound.registerSound(n,r)}},{"./sound":32}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ui=void 0;var r=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=e("./data"),i=e("./language"),o=e("./layout"),s=void 0,u=void 0,c=void 0,l=null,d={},f=[],p=function(e){return $('<button class="button--action '+e+"\" tabIndex='-1'>"+(0,i._)(e)+"</button>").appendTo("#game-content")},h=function(e){return d[e]||(d[e]=p(e)),d[e]},g=function(e){return f.find(function(t){return t.name===e})},m=function(){var e=$(window);s=p("statistics"),u=$('<div class="toast"></div>').appendTo("#game-content"),c=$('<div id="end-message"></div>').appendTo("#game-content"),a.data.on("language",function(){Object.entries(d).forEach(function(e){var t=r(e,2),n=t[0];t[1].text((0,i._)(n))}),s.text((0,i._)("statistics")),v.showMessage(l)}),a.data.on("autoSort",function(e){e?v.hideAction("sort"):v.showAction("sort")});var t=function(){var e=(o.layout.width-o.layout.handWidth)/2;setTimeout(function(t){$(".button--action").toggleClass("button--small",e<200)})};e.on("board:resize",t),t()},v=n.ui={initialize:m,showMessage:function(e){e&&(l=e,u.text((0,i._)(e)).addClass("show"))},hideMessage:function(){l=null,u.removeClass("show")},addActions:function(e){Object.keys(e).forEach(function(t){v.addAction(t,e[t])})},addAction:function(e,t){var n=h(e);n.off("click").on("click",t),f.push({name:e,button:n,show:!1})},showAction:function(e,t){var n=g(e);n&&!n.show&&("sort"===n.name&&a.data.get("autoSort")||(t&&n.button.off("click").on("click",t),n.show=!0,v._setActionsPosition()))},hideAction:function(e){var t=g(e);t&&t.show&&(t.show=!1,v._setActionsPosition())},showWin:function(e,t){c.text(e?(0,i._)("you_won"):(0,i._)("you_lost",{playerName:t})).addClass("show"),c.one("transitionend",this.hideWin)},hideWin:function(){c.removeClass("show")},_setActionsPosition:function(){var e=window.innerWidth<=459?60:70,t=e;f.forEach(function(n,r){var a=n.button,i=n.show;t-=i?e:0,a.css({transform:"translate3d(0, "+t+"px, 0)","z-index":1e3-10*r})})},showStatisticsButton:function(e){s.addClass("show").text((0,i._)("statistics")).off("click").on("click",e)},hideStatisticsButton:function(e){s.removeClass("show")}}},{"./data":"data","./language":"language","./layout":19}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={},a=!1,i="treecardgames.gin.";if(window.Windows&&Windows.Storage&&(a=!0),a){var o=Windows.Storage.ApplicationData.current.localSettings.values;r.get=function(e,t){if(t=t||"","--cut--"==o[e])return r.getChunk(e)||t;var n=o[e];return null===n||void 0===n||""===n?t:""+n},r.getChunk=function(e,t){for(var n=0,r=[];o[n+e];)r.push(o[n+e]),n++;return r.join("")},r.setChunk=function(e,t){o[e]="--cut--";for(var n=0;2e3*n<t.length;)o[n+e]=t.slice(2e3*n,2e3*(n+1)),n++},r.set=function(e,t){null===t?r.remove(e):("--cut--"==o[e]&&r.remove(e),t=""+t,t.length<2e3?o[e]=t+"":r.setChunk(e,t))},r.removeChunk=function(e){for(var t=0;o[t+e];)o.remove(t+e),t++},r.remove=function(e){"--cut--"==o[e]?r.removeChunk(e):o.remove(e)}}else r.set=function(e,t){localStorage.setItem(i+e,t)},r.get=function(e,t){return localStorage.getItem(i+e)||t},r.remove=function(e){localStorage.removeItem(i+e)};r.getInt=function(e){var t=this.get(e);return isNaN(t)?0:parseInt(t,10)},r.getJSON=function(e,t){try{var n=this.get(e);if(n){var r=JSON.parse(n);return null===r?t:r}}catch(e){}return t},r.setJSON=function(e,t){this.set(e,JSON.stringify(t))};n.uniStore=r},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=(n.$$=function(){var e=$([1]);return function(t){return e[0]=t,e}}(),n.groupBy=function(e,t){var n={};return e.forEach(function(e){n[e[t]]=n[e[t]]||[],n[e[t]].push(e)}),n},n.sortBy=function(e,t){return e.slice().sort(function(e,n){return"string"==typeof e[t]?e[t]>n[t]?1:-1:e[t]-n[t]})},n.sortCards=function(e){return e.sort(function(e,t){return e.rank===t.rank?e.suit>t.suit?-1:1:t.rank-e.rank}),e},n.intersects=function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++)if(e[n]===t[r])return!0;return!1},n.difference=function(e,t){for(var n=[],r=0;r<e.length;r++)-1===t.indexOf(e[r])&&n.push(e[r]);return n},n.flatten=function(e){return[].concat.apply([],e)},n.some=function(e,t){return!!e.filter(t).length},n.find=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]},n.remove=function(e,t){return e.filter(function(e){return e!==t})},n.shuffle=function(e){var t,n,r=e.length;if(r)for(;--r;)n=~~(Math.random()*(r+1)),t=e[n],e[n]=e[r],e[r]=t;return e},n.createDeck=function(e){var t=e.createCard,n=e.View,r="spade heart club diamond".split(" "),a=[],i=!0,o=!1,s=void 0;try{for(var u,c=r[Symbol.iterator]();!(i=(u=c.next()).done);i=!0)for(var l=u.value,d=1;d<14;d++)a.push(t({rank:d,suit:l,View:n}))}catch(e){o=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}return a},n.cardPoints=function(e){return e?e.rank>10?10:e.rank:0},function(e,t){return function(){return t(e.apply(void 0,arguments))}});n.pipe=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(r)},n.tap=function(e){return function(t){return e(t),t}},n.ifElse=function(e,t,n){return function(r){return e(r)?t(r):n(r)}},n.when=function(e,t){return function(n){return e(n)?t(n):n}},n.partial=function(e){
for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.bind.apply(e,[null].concat(n))},n.polygon=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,i=n.length;if(i<6)throw new Error("not enough arguments");if(i%2==0)for(e.moveTo(n[0],n[1]),a=2;a<i;a+=2)e.lineTo(n[a],n[a+1]);else{var o,s,u=n[i-1],c=(i-1)/2,l=(n[2*c-2]+n[0])/2,d=(n[2*c-1]+n[1])/2;for(e.moveTo(l,d),a=0;a<c-1;a++)e.arcTo(o=n[2*a],s=n[2*a+1],n[2*a+2],n[2*a+3],u,l,d),l=o,d=s;e.arcTo(n[2*c-2],n[2*c-1],n[0],n[1],u,l,d)}}},{}],37:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.AiPlayer=void 0;var o=function e(t,n,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(r)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../core/player"),c=e("./rules"),l=function(e){return e&&e.__esModule?e:{default:e}}(c),d=e("../core/utils");n.AiPlayer=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._dead={},n}return i(t,e),s(t,[{key:"_name",get:function(){return"aiplayer"}}],[{key:"HIGHEST_SCORE",get:function(){return 2e3}}]),s(t,[{key:"reset",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this._dead={}}},{key:"notify",value:function(e,t){this.cardIsDead(t.rank,t.suit)||(this._dead[t.rank]=this.cardsDeadOfSameRank(t)+1),this._dead[t.rank+","+t.suit]=!0}},{key:"cardIsDead",value:function(e,t){return!!this._dead[e+","+t]}},{key:"cardsDeadOfSameRank",value:function(e){return this._dead[e.rank]||0}},{key:"getBestHand",value:function(){return l.default.getBestHand(this.hand)}},{key:"getSortedBestHand",value:function(){return this.getBestHand()}},{key:"decide",value:function(){var e=l.default.getBestHand(this.hand.cards?this.hand.cards:this.hand),t=e.canKnock?"knock":"discard";this.setCardsScore();var n=(0,d.sortBy)(this.hand.cards?this.hand.cards:this.hand,"score")[0];this.notifyObservers(this,t,n)}},{key:"setCardsScore",value:function(){var e=this,n=this.hand.cards||this.hand,r=l.default.getBestHand(n);r.melds.forEach(function(e){e.forEach(function(e){return e.score=t.HIGHEST_SCORE})});var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(n){return e.suit===n.suit&&e.rank===n.rank-t}},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(n){return e.suit===n.suit&&e.rank===n.rank+t}},o=r.deadwood;o.forEach(function(t){if((0,d.find)(o,a(t))){var r=e.cardIsDead(t.rank-1,t.suit),s=e.cardIsDead(t.rank+2,t.suit);t.score=e._getCardScore(r,s)}else if((0,d.find)(o,i(t))){var u=e.cardIsDead(t.rank+1,t.suit),c=e.cardIsDead(t.rank-2,t.suit);t.score=e._getCardScore(c,u)}else if((0,d.find)(n,a(t,2))){var l=e.cardIsDead(t.rank+1,t.suit);t.score=e._getCardScore(!0,l)}else if((0,d.find)(n,i(t,2))){var f=e.cardIsDead(t.rank-1,t.suit);t.score=e._getCardScore(!0,f)}else if((0,d.find)(o,function(e){return t.rank===e.rank&&t!==e})){var p=e.cardsDeadOfSameRank(t);t.score=e._getCardScore(p>0,p>1)}t.score=t.score||15-t.rank})}},{key:"takeFirstCard",value:function(e){var t=this.hand.cards||this.hand,n=l.default.getBestHand(t),r=l.default.getBestHand([].concat(t,e));(0,d.flatten)(r.melds).length>(0,d.flatten)(n.melds).length?this.notifyObservers(this,"take_first_card"):this.notifyObservers(this,"skip_first_card")}},{key:"draw",value:function(e,t){var n=this.hand.cards||this.hand;t.length||this.notifyObservers(this,"draw",e[e.length-1]);var r=l.default.getBestHand(n),a=l.default.getBestHand([].concat(n,t[t.length-1]));(0,d.flatten)(a.melds).length>(0,d.flatten)(r.melds).length?this.notifyObservers(this,"draw",t[t.length-1]):this.notifyObservers(this,"draw",e[e.length-1])}},{key:"_getCardScore",value:function(e,n){return e&&n?0:e||n?t.HIGHEST_SCORE-200:t.HIGHEST_SCORE-100}}]),t}(u.Player)},{"../core/player":29,"../core/utils":36,"./rules":40}],38:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Gin=n.states=void 0;var s=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("./rules"),l=function(e){return e&&e.__esModule?e:{default:e}}(c),d=e("../core/utils"),f=e("../core/observable"),p=e("./scoring"),h=e("../core/data"),g=n.states={WAITING:0,DEALING:1,FIRST_TURN:2,DRAWING:3,DISCARDING:4,LAYOFF:5,ROUND_END:6,NEW_ROUND:7,NEW_GAME:8},m=function(e,t){return Math.abs(e.rank-t.rank)},v=100;h.data.on("winScore",function(e){v=e});n.Gin=function(e){function t(e){var n=e.stock,r=e.waste,o=e.players;a(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.round=0,s.stock=n,s.waste=r,s.players=o,s.reset(),s}return o(t,e),u(t,[{key:"currentPlayer",get:function(){return this.players[this.currentPlayerIndex]}},{key:"opponent",get:function(){return this.currentPlayer===this.players[0]?this.players[1]:this.players[0]}}]),u(t,[{key:"reset",value:function(){this.currentPlayerIndex=this.round%2,this.firstCardSkipped=0,this.cardFromWaste=null,this.state=g.DEALING,this.lastState=this.state,this.players.forEach(function(e){return e.knockHand=null})}},{key:"restore",value:function(e){var t,n,a,i,o,u,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{state:g.NEW_GAME};switch(c.state){case g.NEW_GAME:this.notifyObservers("new game"),this.round=0,(t=this.stock).push.apply(t,r(e)),this.players.forEach(function(e){e.score&&e.score.clear()}),this.reset();break;case g.NEW_ROUND:this.notifyObservers("new round"),this.round=c.round,(n=this.stock).push.apply(n,r(e)),this.reset();break;default:this.round=c.round,this.state=c.state,this.lastState=c.lastState,this.firstCardSkipped=c.firstCardSkipped,this.currentPlayerIndex=c.currentPlayerIndex,this.stock.reset();var l=c.waste,d=c.stock,f=s(c.players,2),p=f[0],h=f[1],m=function(t){return e.find(function(e){return e.toString()===t})};if(this.cardFromWaste=m(c.cardFromWaste),(a=this.waste).push.apply(a,r(l.map(m))),(i=this.players[0].hand).push.apply(i,r(p.hand.map(m))),(o=this.players[1].hand).push.apply(o,r(h.hand.map(m))),(u=this.stock).push.apply(u,r(d.map(m))),this.state===g.WAITING)this.state=this.lastState;else if(this.state===g.DEALING){var v;this.players.forEach(function(e){return e.hand.reset()}),this.waste.reset(),this.stock.reset(),(v=this.stock).push.apply(v,r(e))}}}},{key:"notify",value:function(e,t){if(e===this.currentPlayer){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];switch(t){case"draw":this.performDraw.apply(this,r);break;case"discard":this.performDiscard.apply(this,r);break;case"knock":this.handleKnock.apply(this,r);break;case"take_first_card":if(this.lastState!==g.FIRST_TURN)return;var i=this.waste.pop();this.currentPlayer.hand.unshift(i),this.cardFromWaste=i,this.state=g.DISCARDING,this.notifyObservers("take_first_card",this.currentPlayer,i);break;case"skip_first_card":if(this.lastState!==g.FIRST_TURN)return;this.notifyObservers("skip_first_card",this.currentPlayer),this.firstCardSkipped++,this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.players.length,1===this.firstCardSkipped?this.state=g.FIRST_TURN:(this.notifyObservers("end_first_turn",null,this.waste.last()),this.state=g.DRAWING)}}}},{key:"handleKnock",value:function(){if(this.lastState!==g.DISCARDING)throw new Error("A player tried to knock during "+this._getStateName());var e=l.default.getBestHand(this.currentPlayer.hand),t=e.biggerDeadwood;e.deadwoodSum,(0,d.cardPoints)(t);e.isBigGin?(this.state=g.ROUND_END,this.notifyObservers("big_gin",this.currentPlayer)):e.isGin?(this.state=g.ROUND_END,this.currentPlayer.hand.remove(t),this.waste.addKnockCard(t),this.notifyObservers("gin",this.currentPlayer,t)):e.canKnock?(this.state=g.LAYOFF,this.currentPlayer.hand.remove(t),this.waste.addKnockCard(t),this.notifyObservers("knock",this.currentPlayer,t)):this.notifyObservers("invalid knock",this.currentPlayer)}},{key:"performDraw",value:function(e){if(this.lastState!==g.DRAWING)throw new Error("A player tried to draw a card during "+this._getStateName());if(e===this.stock.last())this.cardFromWaste=null,this.stock.pop();else{if(e!==this.waste.last()||2===this.firstCardSkipped)return;this.cardFromWaste=e,this.waste.pop()}this.firstCardSkipped=0,this.currentPlayer.hand.unshift(e),this.state=g.DISCARDING,l.default.getBestHand(this.currentPlayer.hand).canKnock&&this.notifyObservers("can knock",this.currentPlayer),this.notifyObservers("draw",this.currentPlayer,e)}},{key:"performDiscard",value:function(e){this.currentPlayer.hand.contains(e)&&(e===this.cardFromWaste?this.notifyObservers("invalid discard",this.currentPlayer):(this.currentPlayer.hand.remove(e),this.waste.push(e),this.notifyDeadCard(),this.state=g.DRAWING,this.notifyObservers("discard",this.currentPlayer,e),this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.players.length))}},{key:"notifyDeadCard",value:function(){var e=this;this.waste.size>=2&&this.players.forEach(function(t){t.notify("card.dead",e.waste.cards[e.waste.size-2])})}},{key:"update",value:function(){switch(this.state!==g.WAITING&&(this.lastState=this.state),this.state){case g.DEALING:this.deal();break;case g.FIRST_TURN:this.currentPlayer.takeFirstCard(this.waste.last()),this.notifyObservers("first turn",this.currentPlayer),this.state=g.WAITING;break;case g.DRAWING:this.draw();break;case g.DISCARDING:this.discard();break;case g.LAYOFF:this.layoff();break;case g.ROUND_END:this.roundEnd()}}},{key:"layoff",value:function(){for(var e=this,t=this.currentPlayer.getSortedBestHand(),n=this.opponent.getSortedBestHand().deadwood;;){var r=n.find(function(n){return e._insertCardInMelds(n,t.melds)});if(!r)break;n=(0,d.remove)(n,r),this.opponent.hand.remove(r),this.currentPlayer.hand.push(r)}this.currentPlayer.knockHand=t,this.opponent.knockHand=this.opponent.getSortedBestHand(),this.state=g.ROUND_END,this.notifyObservers("layoff",this.opponent)}},{key:"_insertCardInMelds",value:function(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(this._canInsertCardInMeld(e,s))return s.push(e),e}}catch(e){r=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw a}}}},{key:"_canInsertCardInMeld",value:function(e,t){var n=t[0].rank!==t[1].rank,r=t[0].suit===e.suit,a=t[0].rank===e.rank;if(n){var i=m.bind(null,e),o=(0,d.some)(t,function(e){return 1===i(e)});return r&&o}if(a)return!0}},{key:"deal",value:function(){for(var e=0;e<10;e++)this.players[0].hand.push(this.stock.pop()),this.players[1].hand.push(this.stock.pop());this.waste.push(this.stock.pop()),this.state=g.FIRST_TURN,this.notifyObservers("dealing")}},{key:"draw",value:function(){this.stock.size<=2?(this.state=g.NEW_ROUND,p.scoring.tie.apply(p.scoring,r(this.players)),this.notifyObservers("tied game")):(this.currentPlayer.draw(this.stock.cards,this.waste.cards),this.state=g.WAITING,this.notifyObservers("drawing",this.currentPlayer))}},{key:"discard",value:function(){this.state=g.WAITING,this.currentPlayer.decide(),l.default.getBestHand(this.currentPlayer.hand).canKnock&&this.notifyObservers("can knock",this.currentPlayer),this.notifyObservers("discarding",this.currentPlayer)}},{key:"roundEnd",value:function(){this.round+=1;var e=p.scoring.calc({knocker:this.currentPlayer,opponent:this.opponent}),t=e.winner;e.loser;t.score._roundSum>=v?(this.state=g.NEW_GAME,this.notifyObservers("game end",t)):(this.state=g.NEW_ROUND,this.notifyObservers("round end",t))}},{key:"_getStateName",value:function(){for(var e in g)if(g[e]===this.lastState)return e}},{key:"toJSON",value:function(){return{round:this.round,stock:this.stock,waste:this.waste,players:this.players,currentPlayerIndex:this.currentPlayerIndex,firstCardSkipped:this.firstCardSkipped,state:this.state,lastState:this.lastState,cardFromWaste:this.cardFromWaste}}}]),t}(f.Observable)},{"../core/data":"data","../core/observable":24,"../core/utils":36,"./rules":40,"./scoring":42}],39:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.HumanPlayer=void 0;var o=function e(t,n,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(r)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../core/player"),c=e("./gin"),l=e("./rules");n.HumanPlayer=function(e){function t(){var e;r(this,t);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var s=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)));return s.meldsOrder=new Map,s.uid=1e3,s}return i(t,e),s(t,[{key:"_name",get:function(){return"humanplayer"}}]),s(t,[{key:"notify",value:function(){}},{key:"decide",value:function(){}},{key:"draw",value:function(e,t){this.stock=e,this.waste=t}},{key:"takeFirstCard",value:function(e){this.firstCard=e}},{key:"reset",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this.meldsOrder=new Map,this.uid=1e3}},{key:"getBestHand",value:function(){return l.rules.getBestHand(this.hand)}},{key:"getSortedBestHand",value:function(){var e=this,t=this.getBestHand(),n=this.meldsOrder;return t.melds.forEach(function(t){var r=t.join();n.has(r)||n.set(r,e.uid--)}),t.melds=t.melds.sort(function(e,t){var r=e.join(),a=t.join();return n.get(r)-n.get(a)}),t}},{key:"executeAction",value:function(e,t){e===c.states.DRAWING&&(-1!==this.stock.indexOf(t)?t=this.stock[this.stock.length-1]:-1!==this.waste.indexOf(t)&&(t=this.waste[this.waste.length-1])),e===c.states.FIRST_TURN?this.firstCard===t?(this.firstCard=null,this.notifyObservers(this,"take_first_card")):null===t&&this.notifyObservers(this,"skip_first_card"):e===c.states.DISCARDING&&t.owner===this.hand?(t.view.setHighlight(""),this.notifyObservers(this,"discard",t)):e===c.states.DRAWING&&(-1===this.stock.indexOf(t)&&-1===this.waste.indexOf(t)||this.notifyObservers(this,"draw",t))}}]),t}(u.Player)},{"../core/player":29,"./gin":38,"./rules":40}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.rules=void 0;var r=e("../core/utils"),a=function(e,t){return e.suit===t.suit&&e.rank===t.rank-1},i=function(e){return e.reduce(function(e,t){return e+(0,r.cardPoints)(t)},0)},o=function(e){return e.cards||e},s=n.rules={getRuns:function(e){var t=[];return e=(0,r.sortBy)(o(e),"rank"),e.forEach(function(n,r){for(var i=[n],o=r+1;o<e.length;o++){var s=e[o];a(n,s)&&(n=s,i.push(n),i.length>=3&&t.push(i.slice()))}}),e=null,t},getSets:function(e){var t=[];e=(0,r.groupBy)(o(e),"rank");for(var n in e)if(!(e[n].length<3)){var a=(0,r.sortBy)(e[n],"suit");t.push(a),4===a.length&&(t.push([a[0],a[1],a[2]]),t.push([a[0],a[1],a[3]]),t.push([a[0],a[2],a[3]]),t.push([a[1],a[2],a[3]]))}return e=null,t},getValidMeldsCombinations:function(e){e=o(e);for(var t=[].concat(this.getRuns(e),this.getSets(e)),n=[],a=0;a<t.length;a++){for(var i=[[t[a]]],s=a+1;s<t.length;s++)for(var u=i.length,c=0;c<u;c++){var l=i[c];(function(e,t){return(0,r.some)(e,function(e){return(0,r.intersects)(e,t)})})(l,t[s])||(i.push(l.slice()),l.push(t[s]))}n.push.apply(n,i)}return e=null,n},getBestHand:function(e){e=(0,r.sortCards)(o(e).slice());var t=this.getValidMeldsCombinations(e);if(0===t.length)return{melds:[],deadwood:e.slice(),deadwoodSum:i(e),isGin:!1,isBigGin:!1,canKnock:!1,biggerDeadwood:(0,r.sortBy)(e,"rank").pop()};var n=t.map(function(t){return{melds:t,deadwood:(0,r.difference)(e,(0,r.flatten)(t))}}).sort(function(e,t){if((0,r.flatten)(e.melds).length>=10||(0,r.flatten)(t.melds).length>=10)return(0,r.flatten)(t.melds).length-(0,r.flatten)(e.melds).length;if(i(e.deadwood)!==i(t.deadwood))return i(e.deadwood)-i(t.deadwood);var n=(0,r.sortBy)(e.deadwood,"rank").pop(),a=(0,r.sortBy)(t.deadwood,"rank").pop();return(a?a.rank:0)-(n?n.rank:0)})[0];return e=null,t=null,n.deadwoodSum=i(n.deadwood),n.biggerDeadwood=(0,r.sortBy)(n.deadwood,"rank").pop(),n.canKnock=this._canKnock(n),n.isGin=this._isGin(n),n.isBigGin=this._isBigGin(n),n},_canKnock:function(e){var t=(0,r.sortBy)(e.deadwood,"rank");return t.pop(),i(t)<=10},_isGin:function(e){return e.canKnock&&10===(0,r.flatten)(e.melds).length},_isBigGin:function(e){return e.canKnock&&11===(0,r.flatten)(e.melds).length}};n.default=s},{"../core/utils":36}],41:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.Score=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];a(this,e),this.rounds=[].concat(r(t))}return i(e,[{key:"clear",value:function(){this.rounds.length=0}},{key:"add",value:function(e){this.rounds.push(e)}},{key:"toJSON",value:function(){return this.rounds}},{key:"total",get:function(){return this._roundSum+this.totalBonus}},{key:"totalBonus",get:function(){return this.gameBonus+this.shutoutBonus+this.boxBonus}},{key:"gameBonus",get:function(){return this._roundSum>=100?100:0}},{key:"boxBonus",get:function(){return 25*this.wins}},{key:"shutoutBonus",get:function(){return this.wins<this.rounds.length?0:this._roundSum}},{key:"wins",get:function(){return this.rounds.filter(function(e){return e.score+e.bonus}).length}},{key:"_roundSum",get:function(){return this.rounds.reduce(function(e,t){return e+t.score+t.bonus},0)}}]),e}()},{}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.scoring=void 0;var r=e("./rules"),a=e("./score"),i={gin:25,big_gin:50,undercut:25,knock:0};n.scoring={calc:function(e){var t=e.knocker,n=e.opponent,o=t.knockHand||r.rules.getBestHand(t.hand),s=n.knockHand||r.rules.getBestHand(n.hand),u=s.deadwoodSum-o.deadwoodSum,c=10!==n.hand.size;t.score=t.score||new a.Score,n.score=n.score||new a.Score;var l=t,d=n,f="knock";if(o.isGin&&!c)f="gin";else if(o.isBigGin&&!c)f="big_gin";else if(u<=0){f="undercut";var p=[d,l];l=p[0],d=p[1]}return l.score.add({score:Math.abs(u),bonus:i[f],type:f}),d.score.add({score:0,bonus:0,type:f}),{winner:l,loser:d}},tie:function(e,t){e.score=e.score||new a.Score,t.score=t.score||new a.Score,e.score.add({type:"tie",score:0,bonus:0}),t.score.add({type:"tie",score:0,bonus:0})}}},{"./rules":40,"./score":41}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drag=void 0;var r=(e("../core/utils"),e("./selection")),a=e("../core/layout");n.drag=function(e){var t=e.deck,n=e.board,i=e.canDrag,o=e.onDragStart,s=e.onDragEnd,u=e.moveCard,c=$(document),l=void 0,d=!1,f=null,p=null,h=null,g=function(e,t){l=setTimeout(function(){return c.on("mousemove",v)},100),d=!1,f=e,p={x:e.x,y:e.y,z:e.z},h=t.pageX},m=((0,r.getCard)(t),function(e,t){i(e)&&g(e,t)});n.onMouseDownCard.registerObserver(function(e,t){m(e,t)}),c.on("mouseup",function(e){if(clearTimeout(l),c.off("mousemove",v),t.sort(function(e,t){return e.z-t.z}),d){var n=e.pageX-h;s(f,p.x,n),f=null,d=!1}});var v=function(e){d||(d=!0,t.splice(t.indexOf(f),1),t.push(f),o());var n=e.pageX-h;u(f,{x:n+p.x,y:p.y-.3*a.layout.cardHeight,z:1e3})}}},{"../core/layout":19,"../core/utils":36,"./selection":45}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./drag");Object.defineProperty(n,"drag",{enumerable:!0,get:function(){return r.drag}});var a=e("./selection");Object.defineProperty(n,"getCard",{enumerable:!0,get:function(){return a.getCard}}),Object.defineProperty(n,"getSelection",{enumerable:!0,get:function(){return a.getSelection}}),Object.defineProperty(n,"setSelection",{enumerable:!0,get:function(){return a.setSelection}}),Object.defineProperty(n,"deselect",{enumerable:!0,get:function(){return a.deselect}});var i=e("./size");Object.defineProperty(n,"resize",{enumerable:!0,get:function(){return i.resize}})},{"./drag":43,"./selection":45,"./size":46}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getCard=n.deselect=n.getSelection=n.setSelection=void 0;var r=e("../core/utils"),a=(e("../core/animate.dom"),e("../core/data"),void 0),i=function(e,t){return(0,r.find)(e,function(e){return e.view.$dom[0]===t})},o=(n.setSelection=function(e){return a=a===e?null:e},n.getSelection=function(){return a},n.deselect=function(){a=null},function(e){return e.currentTarget});n.getCard=function(e){return(0,r.pipe)(o,(0,r.partial)(i,e))}},{"../core/animate.dom":6,"../core/data":"data","../core/utils":36}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resize=void 0;var r=e("../core/layout"),a=e("../containers"),i=e("../players"),o=(n.resize=function(){$(".poker-card").css({marginLeft:-r.layout.originalCardWidth/2,marginTop:-r.layout.originalCardHeight/2});var e=r.layout.cardWidth,t=r.layout.cardHeight;a.stock.setPosition(-e,Math.floor(.3*-t)),a.waste.setPosition(e,Math.floor(.3*-t)),i.cpu.hand.setPosition(0,r.layout.top),i.human.hand.setPosition(0,r.layout.bottom),i.cpu.containers&&o(i.cpu),i.human.containers&&o(i.human)},function(e){var t=e.containers.reduce(function(e,t){return e+t.width+(t.width?20:0)},0)-20,n=-parseInt(t/2)+parseInt(r.layout.cardWidth/2);e.containers.forEach(function(t){t.setPosition(n,e.hand.position.y),n+=t.width+20})})},{"../containers":4,"../core/layout":19,"../players":66}],47:[function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=e("./gin/gin"),o=e("./players"),s=e("./containers"),u=e("./core/card"),c=e("./core/utils"),l=e("./core/ui"),d=(e("./core/image.maker"),e("./core/data")),f=e("./core/uniStore"),p=e("./core/resources"),h=e("./core/loader"),g=e("./core/platform"),m=e("./gin/score"),v=e("./core/popups"),y=e("./helpers"),w=e("./player.actions"),b=e("./player.info"),_=e("./observers"),k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(_),O=e("./core/language"),P=(e("./gin/rules"),e("./visual.effects")),S=e("./board"),j=e("./view");e("./ads/ads.for.games");var C=window.debugGameState;d.data.addWrapper("score",function(e){var t=e.human,n=e.cpu;return{cpu:new m.Score(n),human:new m.Score(t)}});var x=function(e){return/^player_name\d$/.test(e._name)},A=function(e){var t=e.human,n=e.cpu;return t.name=x(t)?(0,O._)(t._name):t._name,n.name=x(n)?(0,O._)(n._name):n._name,{human:t,cpu:n}};d.data.addWrapper("players",A),d.data.on("players",A),d.data.on("language",function(e,t){d.data.set("game.title",(0,O._)("name")),document.title=(0,O._)("name"),$("html").removeClass("locale-"+t).addClass("locale-"+e),A(d.data.get("players"))});var M=function(){var e,t,n=$(".score"),p=(0,c.createDeck)({createCard:u.createCard,View:j.View}),h=(0,j.createAnimationFunctions)(p),m=h.animate,_=h.stopAnimation,x=h.move,A=h.drawAll,M=window.players=[o.cpu,o.human],E=new i.Gin({stock:s.stock,waste:s.waste,players:M}),T=[E,s.stock,s.waste,o.human,o.cpu],I={statistics:function(){n.click()},sort:function(){if(!d.data.get("autoSort")){var e=o.human.getSortedBestHand(),t=e.deadwood,n=e.melds;o.human.hand.cards=[].concat(a((0,c.sortCards)(t)),a((0,c.flatten)(n.reverse().map(c.sortCards)))),o.human.hand.updateIndexes(),m().catch(function(e){return e})}},skip_first_card:function(){o.human.executeAction(E.lastState,null),l.ui.hideAction("skip_first_card"),E.waste.last().view.setHighlight(""),W()},go:function(){E.lastState===i.states.FIRST_TURN?E.waste.contains((0,y.getSelection)())&&(E.waste.last().view.setHighlight(""),o.human.executeAction(E.lastState,(0,y.getSelection)()),l.ui.hideAction("skip_first_card")):(o.human.executeAction(E.lastState,(0,y.getSelection)()),l.ui.hideAction("go"))},continue:function(){R()},new_game:function(){R()},knock:function(){l.ui.hideMessage(),E.notify(o.human,"knock"),W()}},D=(e={},r(e,i.states.DRAWING,!0),r(e,i.states.DISCARDING,!0),e),N=(t={},r(t,i.states.ROUND_END,!0),r(t,i.states.LAYOFF,!0),t),B=function(){return E.currentPlayer===o.human&&D[E.lastState]},W=function(){return B()&&!N[E.state]?(E.update(),m().catch(function(e){return e})):m().then(function(){E.update()}).catch(function(e){return e})},z=function(){["continue","new_game","go"].forEach(l.ui.hideAction),l.ui.hideStatisticsButton(),T.forEach(function(e){return e.reset()}),M.forEach(function(e){return e.info.stopThinking()}),p.forEach(function(e){e.isKnockCard=!1,e.view.setHighlight(""),e.view.untint(),e.removeFromMeld()})},R=function(){z(),_();var e=C||f.uniStore.getJSON("game.state");C=null,E.restore((0,c.shuffle)(p),e),x().then(function(){o.human.hand.rotation=180,o.cpu.hand.rotation=0,I.sort(),m().then(function(){return l.ui.showAction("sort")}).catch(function(e){return e}),E.update()})},F=new S.Board(p),L={gin:E,animate:m,data:d.data,deck:p,actions:I,platform:g.platform,moveCard:j.moveCard,board:F,drawAll:A};[l.ui,d.data,b.playerInfo,w.playerActions,P.visualEffects].forEach(function(e){e.initialize(L)}),Object.values(k).forEach(function(e){E.registerObserver(e(L))}),o.human.score=d.data.get("score").human,o.cpu.score=d.data.get("score").cpu,l.ui.addActions(I),o.cpu.registerObserver(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];setTimeout(function(){E.notify.apply(E,t),W()},500)}),o.human.registerObserver(function(){E.notify.apply(E,arguments),W()}),E.registerObserver(function(e,t,n){switch(e){case"discarding":case"draw":t===o.human&&E.cardFromWaste&&E.cardFromWaste.view.tint();break;case"knock":case"gin":case"big_gin":case"discard":E.cardFromWaste&&E.cardFromWaste.view.untint(),n&&n.removeFromMeld(),l.ui.hideAction("go"),l.ui.hideAction("knock");break;case"first turn":E.waste.last().view.setHighlight("#83e3f7"),A(),t===o.human&&l.ui.showAction("skip_first_card");break;case"new game":case"end_first_turn":case"take_first_card":n&&(n.view.setHighlight(""),t===o.human&&n.view.tint()),o.cpu.info.say("");break;case"dealing":m({delay:.05}).then(function(e){o.human.hand.rotation=180,I.sort(),W().then(function(){return l.ui.showAction("sort")})}).catch(function(e){return e});break;case"can knock":t===o.human&&l.ui.showAction("knock");break;case"round end":case"tied game":case"game end":l.ui.hideAction("sort");break;case"game restart":f.uniStore.setJSON("game.state",null),d.data.set("score",void 0),R()}}),$(window).on("board:resize",function(e){(0,y.resize)(),x().then(A)}),$(document).on("click",".new-game",function(){(0,v.confirm)((0,O._)("confirm_restart")).then(function(){E.notifyObservers("game restart")}).catch(function(e){return e})}),$(document).on("contextmenu",function(e){return!1}),(0,y.resize)(),R()},E=function(){h.progressBar.apply(void 0,a((0,p.getResources)())).then(function(){d.data.set("game.loaded"),setTimeout(function(e){$(".splash").hide(),M(),document.getElementById("game-content").addEventListener("click",function(){})},300)})};navigator.serviceWorker?navigator.serviceWorker.getRegistration().then(function(e){if(!e)return E();navigator.serviceWorker.ready.then(function(e){"activated"===e.active.state?E():e.active.onstatechange=E})}).catch(E):E()},{"./ads/ads.for.games":1,"./board":2,"./containers":4,"./core/card":8,"./core/data":"data","./core/image.maker":18,"./core/language":"language","./core/loader":20,"./core/platform":26,"./core/popups":"popups","./core/resources":30,"./core/ui":34,"./core/uniStore":35,"./core/utils":36,"./gin/gin":38,"./gin/rules":40,"./gin/score":41,"./helpers":44,"./observers":55,"./player.actions":63,"./player.info":64,"./players":66,"./view":67,"./visual.effects":68}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.adrefresh=function(){var e=Date.now(),t=function(){Date.now()-e>12e4&&(window.dispatchEvent(createEvent("refresh-ad")),e=Date.now())};return function(e){switch(e){case"new game":case"new round":t()}}}},{}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ads=void 0;var r=e("../players");n.ads=function(){var e=$(window);return function(t,n,a){switch(t){case"new game":e.trigger("game:start"),console.log("STARTS NEW GAME");break;case"game end":n===r.human&&(e.on("game:won"),console.log("HUMAN WINS"))}}}},{"../players":66}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.animations=void 0;var r=e("../player.info"),a=e("../core/ui");n.animations=function(e){var t=e.actions,n={"round end":"continue","tied game":"continue","game end":"new_game"},i=function(e){a.ui.showStatisticsButton(t.statistics),a.ui.showAction(n[e])};return function(e,t){switch(e){case"round end":case"game end":case"tied game":
r.playerInfo.show(t,"game end"===e).then(function(t){i(e)});break;case"new game":case"new round":r.playerInfo.hide()}}}},{"../core/ui":34,"../player.info":64}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.audio=void 0;var r=e("../core/sound"),a=e("../players"),i=e("../core/data"),o=e("../player.info");i.data.on("sound",function(e){e?r.sound.unmute():r.sound.mute()});n.audio=function(e){var t=e.data,n=t.get("handMoveDelay");return function(e,t,i){switch(e){case"draw":setTimeout(function(){t===a.human?setTimeout(function(){r.sound.play("moveCard")},n):r.sound.play("moveCard")});break;case"discard":r.sound.play("moveCard");break;case"gin":case"big_gin":t._roundSum<100&&r.sound.play("gameCompleted");break;case"game end":t===a.human?o.playerInfo.onAnimationEnd(function(e){r.sound.play("gameWon")}):r.sound.play("gameCompleted");break;case"round end":r.sound.play("gameCompleted")}}}},{"../core/data":"data","../core/sound":31,"../player.info":64,"../players":66}],52:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.autosort=void 0;var a=e("../players"),i=e("../core/data"),o=e("../core/utils"),s=function(e){e.hand.cards.forEach(function(e){e.removeFromMeld()});var t=e.getSortedBestHand(),n=t.deadwood,a=t.melds;e.hand.cards=[].concat(r((0,o.sortCards)(n)),r((0,o.flatten)(a.reverse().map(o.sortCards)))),a.forEach(function(e,t){e.forEach(function(e){e.addToMeld(t)})}),e.hand.updateIndexes()};n.autosort=function(e){var t=(e.gin,e.animate);i.data.on("autoSort",function(e){e&&(s(a.human),t())});var n=!1;return function(e,r,o){if(i.data.get("autoSort"))switch(e){case"draw":case"discard":case"take_first_card":r===a.human&&s(a.human);break;case"dealing":s(a.human);break;default:if(n)return;n=!0,s(a.human),t()}}}},{"../core/data":"data","../core/utils":36,"../players":66}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.counter=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=e("../players"),i=e("../core/data"),o=(e("../gin/rules"),e("../core/layout")),s=e("../core/utils"),u=e("../core/language"),c={spade:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.77 29.141"><path d="M14.434 0q1.836 3.262 6.054 8.652 4.63 5.43 4.746 6.543.762 1.66.762 3.223v.781q0 3.262-3.164 5.137-1.035.43-2.285.43-3.008 0-4.863-4.317h-.82v.235q0 5.527 1.62 8.457h-4.199v-.118q1.66-2.949 1.66-8.515l-.058-.059h-.742l-.918 1.719q-1.66 2.598-4.141 2.598-3.652 0-5.137-4.082l-.176-1.426v-.899q0-3.574 3.653-7.539Q12.578 3.281 14.316.06L14.375 0h.059z"/></svg>',heart:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.77 29.141"><path d="M7.657.876q3.726 0 5.856 4.314.77 1.707.808 2.606h.055q.643-2.974 2.33-4.938Q18.69.876 21.169.876q3.837 0 6.15 4.112.588 1.523.588 2.864 0 4.59-3.82 8.756l-9.71 11.657h-.11L3.947 15.617Q.864 11.854.864 7.852q0-3.875 3.654-6.15Q6.059.876 7.658.876z" fill="#bf000d"/></svg>',club:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.77 29.141"><path d="M14.414 0q4.18 0 6.152 4.434.254 1.015.313 2.109 0 2.285-2.344 5.41l-1.172 1.172h.059q1.445-.547 3.086-.547h.37q4.65 0 6.524 3.945.45 1.29.45 2.461 0 4.004-4.082 6.036-.782.234-2.168.351-4.727 0-6.7-5.351h-.058v.175q0 6.7 1.601 8.828v.118h-4.062l-.117-.118q1.66-2.5 1.66-9.003v-.059h-.059q-1.953 5.41-6.738 5.41-3.73 0-5.723-3.926-.488-1.328-.488-2.46 0-4.551 4.805-6.172 1.289-.235 2.285-.235h.176q1.68 0 3.203.547h.058v-.059q-1.64-1.386-2.207-2.734-1.172-2.148-1.172-3.73v-.274q0-3.926 4.2-5.957Q13.652 0 14.414 0z"/></svg>',diamond:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.77 29.141"><path d="M14.404 0l9.825 12.754q1.347 1.66 1.347 1.914L14.404 29.141q-.234-.157-11.21-14.473 0-.273 2.167-2.969L14.404 0z" fill="#bf000d"/></svg>'},l={1:"A",11:"J",12:"Q",13:"K"};n.counter=function(){var e=function(e){return'<span class="counter--card '+e.suit+'">\n            <span class="counter--card-rank">'+(l[e.rank]||e.rank)+'</span>\n            <span class="counter--card-suit">'+c[e.suit]+"</span>\n        </span>"},t=function(t){var n=t.deadwood,r=t.melds,a=t.deadwoodSum;return'<div class="counter '+(r.length?"":"empty")+'">\n            <span class="counter--title">'+(0,u._)("melds")+'</span>\n            <div class="counter--cards-wrapper">\n                '+r.map(function(t){return'<span class="counter--meld">\n                        '+t.map(e).join("")+"\n                        </span>"}).join("")+'\n            </div>\n        </div>\n\n        <div class="counter">\n            <span class="counter--title">'+(0,u._)("deadwood")+" ("+a+')</span>\n            <div class="counter--cards-wrapper">\n                '+n.map(e).join("")+"\n            </div>\n        </div>"},n=$('<div class="counters human">').appendTo("#game-content"),d=$('<div class="counters cpu">'),f=function(){var e=window.innerWidth,t=e<=600?-10:60,r=o.layout.handWidth-t;n.css({transform:"translate3d(\n                        "+(o.layout.handRight-r+(70-t)|0)+"px,\n                        "+(o.layout.height-o.layout.cardHeight)+"px, 0)",width:r}),d.css({transform:"translate3d(\n                "+(o.layout.handRight-r+(50-t)|0)+"px,\n                "+o.layout.cardHeight+"px, 0)",width:r,zIndex:1e3})};f();var p=function(){var e=a.human.knockHand||a.human.getSortedBestHand(),i=a.cpu.knockHand||a.cpu.getBestHand(),o=(0,s.sortCards)(e.deadwood.slice()).reverse(),u=(0,s.sortCards)(i.deadwood.slice()).reverse();d.html(t(r({},i,{melds:[],deadwood:u}))),n.html(t(r({},e,{deadwood:o}))),setTimeout(f)};i.data.on("language",p),$(window).on("board:resize",f);var h=!1;return function(e,t){switch(e){case"discard":case"draw":case"knock":case"gin":t===a.human&&p();break;case"new game":case"new round":n.hide(),d.remove(),p();break;case"round end":case"game end":d.appendTo("#game-content"),p();break;case"dealing":n.show(),p();break;case"take_first_card":p();break;default:h||(h=!0,p())}}}},{"../core/data":"data","../core/language":"language","../core/layout":19,"../core/utils":36,"../gin/rules":40,"../players":66}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.events=void 0;e("../player.info"),n.events=function(e){var t=e.data;return function(e){switch(e){case"tied game":case"game end":case"round end":t.set("game.round.end",!0)}}}},{"../player.info":64}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./messages");Object.defineProperty(n,"messages",{enumerable:!0,get:function(){return r.messages}});var a=e("./statistics");Object.defineProperty(n,"statistics",{enumerable:!0,get:function(){return a.statistics}});var i=e("./audio");Object.defineProperty(n,"audio",{enumerable:!0,get:function(){return i.audio}});var o=e("./storage");Object.defineProperty(n,"storage",{enumerable:!0,get:function(){return o.storage}});var s=e("./melds");Object.defineProperty(n,"melds",{enumerable:!0,get:function(){return s.melds}});var u=e("./animations");Object.defineProperty(n,"animations",{enumerable:!0,get:function(){return u.animations}});var c=e("./counter");Object.defineProperty(n,"counter",{enumerable:!0,get:function(){return c.counter}});var l=e("./rate.reminder");Object.defineProperty(n,"reminder",{enumerable:!0,get:function(){return l.reminder}});var d=e("./events");Object.defineProperty(n,"events",{enumerable:!0,get:function(){return d.events}});var f=e("./autosort");Object.defineProperty(n,"autosort",{enumerable:!0,get:function(){return f.autosort}});var p=e("./adrefresh");Object.defineProperty(n,"adrefresh",{enumerable:!0,get:function(){return p.adrefresh}});var h=e("./winscore");Object.defineProperty(n,"winscore",{enumerable:!0,get:function(){return h.winscore}});var g=e("./ads");Object.defineProperty(n,"ads",{enumerable:!0,get:function(){return g.ads}})},{"./adrefresh":48,"./ads":49,"./animations":50,"./audio":51,"./autosort":52,"./counter":53,"./events":54,"./melds":56,"./messages":57,"./rate.reminder":59,"./statistics":60,"./storage":61,"./winscore":62}],56:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.melds=void 0;var a=e("../players"),i=e("../core/container"),o=e("../gin/rules"),s=e("../core/utils"),u=e("../helpers"),c=e("../config"),l=(n.melds=function(e){var t=e.gin,n=e.animate;return function(e,r,a){switch(e){case"knock":case"gin":case"big_gin":l();break;case"layoff":r.hand.size<10?setTimeout(function(){l(),n({duration:c.config.layoffAnimationTime}).then(function(){t.update()})},500):t.update();break;case"round end":l(),n(),t.update()}}},function(){d(a.human),d(a.cpu)}),d=function(e){if(e.hand.knock=!0,!e.containers){e.containers=[];for(var t=0;t<4;t++)e.containers.push(new i.Layoff)}e.containers.forEach(function(e){return e.reset()});for(var n=e.knockHand||f(e),a=n.melds.length+(n.deadwood.length?1:0),o=(e.containers,0);o<a;o++){var c=e.containers[o];n.melds[o]?c.push.apply(c,r((0,s.sortBy)(n.melds[o],"rank").reverse())):c.push.apply(c,r(n.deadwood))}(0,u.resize)()},f=function(e){return e.getSortedBestHand?e.getSortedBestHand():o.rules.getBestHand(e.hand)}},{"../config":3,"../core/container":11,"../core/utils":36,"../gin/rules":40,"../helpers":44,"../players":66}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.messages=void 0;var r=e("../core/ui"),a=e("../players"),i=e("../player.info");n.messages=function(){return function(e,t){if(t===a.human)switch(e){case"drawing":r.ui.showMessage("draw_card_message");break;case"discarding":r.ui.showMessage("discard_card_message");break;case"first turn":r.ui.showMessage("first_turn_message");break;case"invalid discard":r.ui.showMessage("invalid_discard_message")}else r.ui.hideMessage();switch(e){case"tied game":r.ui.showMessage("draw_game_message");break;case"game end":i.playerInfo.onAnimationEnd(function(){r.ui.showWin(t===a.human,t.info.name)})}}}},{"../core/ui":34,"../player.info":64,"../players":66}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.all=n.conditions=void 0;var r=e("../gin/human.player");n.conditions={gameEnd:function(e){return"game end"===e.state},isHuman:function(e){return e.player instanceof r.HumanPlayer},isNotExe:function(e){return!0!==e.platform.exe},isNotDisabled:function(e){return!0!==e.data.get("rate.reminder.disabled")},onlyChrome:function(e){var t=e.platform;return!t.web||t.chrome}},n.all=function(e,t){for(var n in e)if(!e[n](t))return!1;return!0}},{"../gin/human.player":39}],59:[function(e,t,n){"use strict";function r(){var e=new Date;return e.getMonth()+"-"+e.getDate()+"-"+e.getFullYear()}Object.defineProperty(n,"__esModule",{value:!0}),n.reminder=void 0;var a=e("./rate.reminder.conditions");n.reminder=function(e){var t=e.data,n=e.platform;return t.on("open.rate",function(){n.winApp?Windows.System.Launcher.launchUriAsync(t.get("rateLink")):window.open(t.get("rateLink"))}),function(e,i){var o={data:t,platform:n,state:e,player:i};if((0,a.all)(a.conditions,o)){var s=t.get("rate.reminder.dates")||[],u=r();-1===s.indexOf(u)&&(s.push(u),t.set("rate.reminder.dates",s)),s.length<5||(t.set("rate.reminder.dates",[]),t.set("modal","rate"))}}}},{"./rate.reminder.conditions":58}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.statistics=void 0;var r=e("../gin/human.player");n.statistics=function(e){var t=e.data;return function(e,n){if("game end"===e||"game restart"===e){var a=t.get("statistics");n instanceof r.HumanPlayer?("won"===a.currentStreakType?a.currentStreak+=1:a.currentStreak=1,a.currentStreak>a.longestWinningStreak&&(a.longestWinningStreak=a.currentStreak),a.currentStreakType="won",a.won+=1):("lost"===a.currentStreakType?a.currentStreak+=1:a.currentStreak=1,a.currentStreak>a.longestLosingStreak&&(a.longestLosingStreak=a.currentStreak),a.currentStreakType="lost",a.lost+=1),t.set("statistics",a)}}}},{"../gin/human.player":39}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.storage=void 0;var r=e("../core/uniStore"),a=e("../players"),i=e("../core/data");n.storage=function(e){var t=e.gin;return function(e){switch(r.uniStore.setJSON("game.state",t),e){case"tied game":case"game end":case"round end":i.data.set("score",{human:a.human.score,cpu:a.cpu.score});break;case"new game":i.data.set("score",void 0)}}}},{"../core/data":"data","../core/uniStore":35,"../players":66}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.winscore=void 0;var r=e("../core/popups"),a=e("../core/language");n.winscore=function(e){var t=e.data,n=e.gin,i=void 0,o=function e(){i!==t.get("winScore")&&(t.off("winScore",e),(0,r.confirm)((0,a._)("win_score_warning")).catch(function(){t.set("winScore",i),t.on("winScore",e)}))};return t.on("options.open",function(){i=t.get("winScore"),t.on("winScore",o)}),t.on("options.close",function(){t.off("winScore",o),i!==t.get("winScore")&&n.notifyObservers("game restart")}),function(){}}},{"../core/language":"language","../core/popups":"popups"}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.playerActions=void 0;var r=e("./core/ui"),a=e("./gin/gin"),i=e("./core/layout"),o=e("./players"),s=e("./core/utils"),u=e("./helpers"),c=e("./core/data"),l=function(e){var t=e.gin,n=e.animate,l=e.deck,d=e.board,f=e.actions,p=e.moveCard,h=function(){return!k&&t.state===a.states.WAITING},g=function(e){return e&&e.owner===o.human.hand},m=function(){var e=t.lastState===a.states.FIRST_TURN,n=t.lastState===a.states.DRAWING,r=c.data.get("confirmMove");return e||n||!r},v=function(e){m()?(f.go(),(0,u.deselect)()):g(e)&&(p(e,{y:e.y-.3*i.layout.cardHeight,duration:.1}),r.ui.showAction("go"))},y=function(){return r.ui.hideAction("go")},w=function(){(0,u.getSelection)()&&g((0,u.getSelection)())&&c.data.get("confirmMove")&&p((0,u.getSelection)(),{duration:.1,y:i.layout.bottom})},b=(0,s.pipe)((0,s.tap)(w),u.setSelection),_=(0,s.when)(h,(0,s.pipe)(b,(0,s.ifElse)(function(e){return e},v,y))),k=void 0,O=function(e,t,a){setTimeout(function(e){k=!1},200),o.human.hand.remove(e);var u=t+a-.5*i.layout.cardWidth,c=(0,s.find)(o.human.hand.cards,function(e){return e.x-.5*i.layout.cardWidth<u});if(c){var l=o.human.hand.cards.indexOf(c);o.human.hand.splice(l,0,e)}else o.human.hand.push(e);e.x+=1,n(),r.ui.hideAction("go")},P=function(){return k=!0};d.onClickCard.registerObserver(function(e){_(e)}),(0,u.drag)({deck:l,board:d,canDrag:g,onDragStart:P,onDragEnd:O,moveCard:p})};n.playerActions={initialize:l}},{"./core/data":"data","./core/layout":19,"./core/ui":34,"./core/utils":36,"./gin/gin":38,"./helpers":44,"./players":66}],64:[function(e,t,n){"use strict";function r(e){return function(){return new Promise(function(t){setTimeout(t,e)})}}Object.defineProperty(n,"__esModule",{value:!0}),n.playerInfo=void 0;var a=e("../core/data"),i=e("../core/layout"),o=e("../players"),s=e("../core/language"),u=e("./info"),c=function(e){return e&&e.__esModule?e:{default:e}}(u),l=$('<div class="win-score-label">'),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.start,o.human.info.find(".player-info--wrapper")),n=t.height()>1.5*parseInt(t.css("font-size")),r=n?65:60;o.human.info.$el.css({transform:"translate3d(\n                        "+(-i.layout.handWidth/2|0)+"px,\n                        "+(i.layout.height/2-i.layout.cardHeight-r|0)+"px, 0)"}),o.cpu.info.$el.css({transform:"translate3d(\n                        "+(i.layout.handWidth/2|0)+"px,\n                        "+(-i.layout.height/2+i.layout.cardHeight+50+15|0)+"px, 0)"})},f=function(){var e=$(".item.players"),t=function(){e.click()};l.appendTo("#game-content"),o.human.info=new c.default(o.human,"human"),o.cpu.info=new c.default(o.cpu,"cpu");var n=o.cpu.takeFirstCard;o.cpu.takeFirstCard=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o.cpu.info.think(3e3).then(function(){return n.apply(o.cpu,t)}).catch(function(e){return e})},o.cpu.registerObserver(function(e,t){"skip_first_card"===t&&o.cpu.info.say("pass")}),o.cpu.info.$el.on("click",t),o.human.info.$el.on("click",t),o.cpu.info.$el.on("touchend",t),o.human.info.$el.on("touchend",t),a.data.on("score",function(e){e.human.rounds.length||(o.human.info.score=0,o.cpu.info.score=0)}),a.data.on("language",function(){o.human.info.name=a.data.get("players").human.name,o.cpu.info.name=a.data.get("players").cpu.name,setTimeout(r)}),a.data.on("players",function(e){o.human.info.name=e.human.name,o.human.info.avatar=e.human.avatar,o.cpu.info.name=e.cpu.name,o.cpu.info.avatar=e.cpu.avatar,setTimeout(function(){r(),d()})});var r=function(){var e=o.cpu.info.find(".player-info--wrapper"),t=o.human.info.find(".player-info--wrapper");e.css("height",""),t.css("height","");var n=Math.max(e.height(),t.height());e.css("height",n),t.css("height",n)};setTimeout(r),d(),$(window).on("board:resize",d)};n.playerInfo={initialize:f,show:function(e,t){var n=this;if(!e)return this._animationEnd(),Promise.resolve();var i=e===o.human?o.cpu:o.human;return e.info.deadwood=0,i.info.deadwood=0,[o.human,o.cpu].forEach(function(e){e.info.find(".points").text(e.score.rounds.slice(-1)[0].score)}),Promise.all([e.info.moveToPlace(1),i.info.moveToPlace(2)]).then(r(500)).then(function(){return l.toggle(100!==a.data.get("winScore")).text((0,s._)("win_score")+": "+a.data.get("winScore")),Promise.all([o.human.info.updateDeadwood(),o.cpu.info.updateDeadwood()]).then(r(500)).then(function(){return Promise.all([e.info.animateScore(e),i.info.animateScore(e)]).then(function(){e.info.find(".deadwood-label").html(t?"&nbsp;":(0,s._)("score")),i.info.find(".deadwood-label").html("&nbsp;")})}).then(r(200)).then(function(){return Promise.all([e.info.showBonus(t,!0),i.info.showBonus(t,!1)])}).then(r(500)).then(function(){return Promise.all([e.info.updateScore(t),i.info.updateScore(t)])}).then(function(){return Promise.all([e.info.showTotalScore(t),i.info.showTotalScore(t)])}).then(function(){n._animationEnd()})})},hide:function(){l.hide(),o.cpu.info.reset(),o.human.info.reset()},_animationEnd:function(){(this._queue||[]).forEach(function(e){return e()}),this._queue=[]},onAnimationEnd:function(e){return this._queue=this._queue||[],this._queue.push(e),this}}},{"../core/data":"data","../core/language":"language","../core/layout":19,"../players":66,"./info":65}],65:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../core/data"),o=e("../core/language"),s=$(document),u=function(e){return 0===e.indexOf("data:")?e:"game/assets/images/players/"+e+".png"},c=function(e){var t=i.data.get("players")[e],n=i.data.get("score")[e];return $('\n        <div class="player-info '+e+'">\n            <div class="message-bubble">I pass</div>\n            <img class="player-info--avatar" src="'+u(t.avatar)+'">\n            <div class="player-info--footer">\n                <span class="player-info--wrapper">\n                    <span class="player-info--name">'+t.name+'</span>\n                    (<span class="player-info--score">'+n._roundSum+'</span>)\n                </span>\n                <div class="deadwood-label"></div>\n                <div class="score-calc">\n                    <div class="deadwood"></div>\n                    <div class="points"></div>\n                </div>\n            </div>\n            <div class="player-info--bonus">\n                <div class="round-bonus">\n                    <span class="bonus-type"></span> +<span class="bonus-amount"></span>\n                </div>\n                <div class="final-bonus">\n                    <span class="bonus-type"></span> +<span class="bonus-amount"></span>\n                </div>\n            </div>\n        </div>')},l=function(){function e(t,n){var a=this;r(this,e),this.player=t,this._name=n,this.$el=c(n).appendTo("#game-content"),this.steps=20,i.data.on("language",function(){a.say(a._lastMessage)})}return a(e,[{key:"deadwoodSum",get:function(){return this.player.knockHand?this.player.knockHand.deadwoodSum:this.player.getBestHand().deadwoodSum}},{key:"score",set:function(e){this.$el.find(".player-info--score").text(e)}},{key:"deadwood",set:function(e){this.$el.find(".deadwood").text(e).css("transform",""),this.$el.find(".deadwood-label").text((0,o._)("deadwood"))}},{key:"name",set:function(e){this.find(".player-info--name").text(e)},get:function(){return this.find(".player-info--name").text()}},{key:"avatar",set:function(e){this.find(".player-info--avatar").attr("src",u(e))}},{key:"nameHeight",get:function(){return this.find(".player-info--name").outerHeight()}}]),a(e,[{key:"say",value:function(e){this._lastMessage=e,e?this.find(".message-bubble").text((0,o._)(e)).show():this.find(".message-bubble").hide()}},{key:"stopThinking",value:function(){clearTimeout(this.thinkTimeout),this.$el.removeClass("thinking")}},{key:"think",value:function(e,t){var n=this;return this.$el.addClass("thinking"),this.say(t||"..."),new Promise(function(t,r){n.thinkTimeout=setTimeout(function(){n.$el.removeClass("thinking"),t()},e)})}},{key:"showBonus",value:function(e,t){return this.$el.find(".final-bonus").hide(),this.$el.find(".round-bonus").hide(),Promise.all([this.showRoundBonus(t),this.showFinalBonus(e,t)])}},{key:"showRoundBonus",value:function(e){var t=this.player.score.rounds.slice(-1)[0];return t.bonus?this._showBonusLabel(e,t.type,t.bonus):Promise.resolve()}},{key:"showFinalBonus",value:function(e,t){return e&&this.player.score.totalBonus?this._showBonusLabel(t,"bonus",this.player.score.totalBonus):Promise.resolve()}},{key:"showTotalScore",value:function(e){var t=this;return e&&this.player.score.total?new Promise(function(e){setTimeout(function(){t.$el.find(".deadwood-label").html((0,o._)("total_score",{_score:t.player.score.total})).hide().fadeIn(),e()},500)}):Promise.resolve()}},{key:"_showBonusLabel",value:function(e,t,n){var r=this,a="bonus"===t?"final":"round";return this.find("."+a+"-bonus").show(),this.find("."+a+"-bonus .bonus-type").text((0,o._)(t)),this.find("."+a+"-bonus .bonus-amount").text(n),new Promise(function(t){s.one("transitionend",".place-"+(e?1:2)+" .player-info--bonus",t),r.$el.addClass("animate-bonus")})}},{key:"updateDeadwood",value:function(){return this._updateCounter(".deadwood",this.deadwoodSum)}},{key:"updateScore",value:function(e){return this._updateCounter(".player-info--score",this.player.score._roundSum)}},{key:"moveToPlace",value:function(e){var t=this;return new Promise(function(n){s.one("transitionend","."+t._name,n),t.$el.addClass("game-end place-"+e)})}},{key:"animateScore",value:function(e){var t=this;return new Promise(function(n){if(s.one("transitionend","."+t._name+" .deadwood",n),t.player!==e){var r=t.find(".deadwood"),a=e.info.find(".deadwood").width();r.css("transform","translateX(-"+(219+(r.width()-a)/2+a|0)+"px)")}t.$el.addClass("animate-score")})}},{key:"reset",value:function(){this.$el.removeClass("game-end place-1 place-2 animate-bonus animate-score")}},{key:"find",value:function(e){return this.$el.find(e)}},{key:"_updateCounter",value:function(e,t){var n=this.find(e),r=parseInt(n.text(),10),a=t-r,i=Math.floor(a/this.steps)||1;return new Promise(function(e){requestAnimationFrame(function a(){if(r>=t)return e();r+=i,r=r>t?t:r,n.text(r),requestAnimationFrame(a)})})}}]),e}();n.default=l},{"../core/data":"data","../core/language":"language"}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.human=n.cpu=void 0;var r=e("./gin/ai.player"),a=e("./gin/human.player"),i=e("./core/container");n.cpu=new r.AiPlayer(new i.Hand),n.human=new a.HumanPlayer(new i.Hand)},{"./core/container":11,"./gin/ai.player":37,"./gin/human.player":39}],67:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.moveCard=n.createAnimationFunctions=n.View=void 0;var a=e("./core/platform"),i=e("./core/canvas.view"),o=e("./core/animate.canvas"),s=r(o),u=e("./core/dom.view"),c=e("./core/animate.dom"),l=r(c),d=/linux/i.test(navigator.userAgent),f=/firefox/i.test(navigator.userAgent),p=/ipod|ipad|iphone/i.test(navigator.userAgent),h=d&&f||a.platform.msedge||p||a.platform.safari,g=(n.View=h?i.CanvasView:u.DomView,h?s:l),m=g.createAnimationFunctions;n.createAnimationFunctions=m;var v=h?s:l,y=v.moveCard;n.moveCard=y},{"./core/animate.canvas":5,"./core/animate.dom":6,"./core/canvas.view":7,"./core/dom.view":17,"./core/platform":26}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.visualEffects=void 0;var r=e("./core/data"),a=(e("./core/utils"),e("./players")),i=void 0;r.data.on("visualEffects",function(e){i=e});var o=function(e){var t=e.board,n=e.drawAll;t.onMouseOverCard.registerObserver(function(e){i&&e.owner===a.human.hand&&(e.view.setHighlight("#83e3f7"),n())}),t.onMouseUpCard.registerObserver(function(e){e.view.setHighlight(""),n()}),t.onMouseDownCard.registerObserver(function(e){i&&e.owner===a.human.hand&&(e.view.setHighlight("#83e3f7"),n())}),t.onMouseOutCard.registerObserver(function(e){i&&e.owner===a.human.hand&&(e.view.setHighlight(""),n())})};n.visualEffects={initialize:o}},{"./core/data":"data","./core/utils":36,"./players":66}],69:[function(e,t,n){function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=b(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function a(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function i(e,t,n){if(t)e.call(n);else for(var r=e.length,a=g(e,r),i=0;i<r;++i)a[i].call(n)}function o(e,t,n,r){if(t)e.call(n,r);else for(var a=e.length,i=g(e,a),o=0;o<a;++o)i[o].call(n,r)}function s(e,t,n,r,a){if(t)e.call(n,r,a);else for(var i=e.length,o=g(e,i),s=0;s<i;++s)o[s].call(n,r,a)}function u(e,t,n,r,a,i){if(t)e.call(n,r,a,i);else for(var o=e.length,s=g(e,o),u=0;u<o;++u)s[u].call(n,r,a,i)}function c(e,t,n,r){if(t)e.apply(n,r);else for(var a=e.length,i=g(e,a),o=0;o<a;++o)i[o].apply(n,r)}function l(e,t,n,r){var i,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(o=e._events,o?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]):(o=e._events=b(null),e._eventsCount=0),s){if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=a(e))&&i>0&&s.length>i){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",u.name,u.message)}}else s=o[t]=n,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=k.call(d,r);return a.listener=n,r.wrapFn=a,a}function p(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function h(e,t){for(var n=t,r=n+1,a=e.length;r<a;n+=1,r+=1)e[n]=e[r];e.pop()}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function v(e){var t=function(){};return t.prototype=e,new t}function y(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n}function w(e){var t=this;return function(){return t.apply(e,arguments)}}var b=Object.create||v,_=Object.keys||y,k=Function.prototype.bind||w;t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var O,P=10;try{var S={};Object.defineProperty&&Object.defineProperty(S,"x",{value:0}),O=0===S.x}catch(e){O=!1}O?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return P},set:function(e){if("number"!=typeof e||e<0||e!==e)throw new TypeError('"defaultMaxListeners" must be a positive number');P=e}}):r.defaultMaxListeners=P,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return a(this)},r.prototype.emit=function(e){var t,n,r,a,l,d,f="error"===e;if(d=this._events)f=f&&null==d.error;else if(!f)return!1;if(f){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var p=new Error('Unhandled "error" event. ('+t+")");throw p.context=t,p}if(!(n=d[e]))return!1;var h="function"==typeof n;switch(r=arguments.length){case 1:i(n,h,this);break;case 2:o(n,h,this,arguments[1]);break;case 3:s(n,h,this,arguments[1],arguments[2]);break;case 4:u(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(r-1),l=1;l<r;l++)a[l-1]=arguments[l];c(n,h,this,a)}return!0},r.prototype.addListener=function(e,t){return l(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return l(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,r,a,i,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=b(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,a=i;break}if(a<0)return this;0===a?n.shift():h(n,a),1===n.length&&(r[e]=n[0]),r.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.removeAllListeners=function(e){var t,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=b(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=b(null):delete n[e]),this;if(0===arguments.length){var a,i=_(n);for(r=0;r<i.length;++r)"removeListener"!==(a=i[r])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=b(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},r.prototype.listeners=function(e){var t,n,r=this._events;return r?(t=r[e],n=t?"function"==typeof t?[t.listener||t]:m(t):[]):n=[],n},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},r.prototype.listenerCount=p,r.prototype.eventNames=function(){
return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],data:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.data=void 0;var r=e("./defaults"),a=e("./data"),i=e("./computed"),o=n.data=new a.Data(r.defaults);(0,i.computed)(o)},{"./computed":12,"./data":13,"./defaults":14}],language:[function(e,t,n){"use strict";function r(e){return JSON.parse(JSON.stringify(e))}function a(e){var t=e.lang;h[t]=r(e),p[t]=(0,c.pipe)(i,o,s)(e),d.data.get("language")===t&&(m=p[t])}function i(e){return $.extend(e.common,e.gin||{})}function o(e){var t={};for(var n in e){var r=n+"$"+l.platform.name.toLowerCase();t[n]=e[r]||e[n]}return t}function s(e){var t=/{{([^}]+)}}/g,n={};for(var r in e)n[r]=e[r].replace(t,function(t,n){return e[n]||d.data.get(n)||v[n]||t});return n}function u(e,t){var n=/{{([^}]+)}}/g;return e.replace(n,function(e,n){return t[n]||e})}Object.defineProperty(n,"__esModule",{value:!0}),n._=void 0;var c=e("./utils"),l=e("./platform"),d=e("./data"),f=e("./loader"),p={},h={},g=void 0,m=void 0,v={year:(new Date).getFullYear()};d.data.on("language",function(e){e!==g&&(g=e,(0,f.preload)("game/js/lang/"+e+".js").then(function(){m=p[e],d.data.forceUpdate("language")}))}),d.data.on("*",function e(t){h[g]&&(d.data.off("*",e),a(r(h[g])),d.data.forceUpdate("language"),d.data.on("*",e))}),Object.defineProperty(window,"define",{value:a,configurable:!1});n._=function(e,t){if(!m)return e;var n=m[e]||p.en[e]||e;return t?u(n,t):n}},{"./data":"data","./loader":20,"./platform":26,"./utils":36}],popups:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.confirmSave=n.close=n.open=n.alert=n.confirm=void 0;var r=e("./data"),a=e("./language");r.data.on("offline",function(){r.data.set("ionicModal",{title:(0,a._)("you_are_offline"),message:(0,a._)("try_again_later"),buttons:[{text:(0,a._)("ok"),role:"cancel"}]})});n.confirm=function(e){return new Promise(function(t,n){r.data.set("ionicModal",{title:(0,a._)("name")+" "+(0,a._)("says"),message:e,buttons:[{text:(0,a._)("ok"),handler:t},{text:(0,a._)("cancel"),handler:n,role:"cancel"}]})})},n.alert=function(e){return new Promise(function(t,n){r.data.set("ionicModal",{title:(0,a._)("name")+" "+(0,a._)("says"),message:e,buttons:[{text:(0,a._)("ok"),handler:t,role:"cancel"}]})})},n.open=function(e){r.data.set("modal",e)},n.close=function(e){r.data.set("modal.close",e)},n.confirmSave=function(){return new Promise(function(e,t){r.data.set("ionicModal",{title:(0,a._)("image_maker"),message:(0,a._)("confirm_close_image_maker"),cssClass:"save-confirm",buttons:[{text:(0,a._)("save"),type:"button-positive",handler:e,role:"reject"},{text:(0,a._)("dont_save"),value:"close",handler:t},{text:(0,a._)("cancel"),value:"cancel"}]})})}},{"./data":"data","./language":"language"}]},{},[47]);